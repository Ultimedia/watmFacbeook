!function(a,b){b["true"]=a;var c={views:{},models:{},routers:{},utils:{},collections:{},adapters:{},settings:{},data:{},helpers:{},messages:{},services:{},events:{},forms:{},garbage:{},storage:{}};c.settings.rootPath="http://localhost/",c.settings.forwardPath="http://ultimedia.biz/watm",c.settings.servicePath=c.settings.rootPath+"services/",c.settings.imagePath=c.settings.rootPath+"common/uploads/",c.settings.badgesPath=c.settings.rootPath+"common/badges/",c.settings.iconPath=c.settings.rootPath+"public/css/assets/",c.settings.sportsPath=c.settings.rootPath+"common/sports/",c.settings.promoPath=c.settings.rootPath+"common/promo/",c.settings.avatarPath="common/avatar/",c.settings.getUserService="getUser.php",c.settings.getUsersService="getUsers.php",c.settings.addUserService="addUser.php",c.settings.getSportsService="getSports.php",c.settings.getActivitiesService="getActivities.php",c.settings.getMessagesService="getMessages.php",c.settings.getChallengesService="getChallenges.php",c.settings.createActivityService="createActivityService.php",c.settings.getUserFromFacebookID="getUserFromFacebookID.php",c.settings.facebookUserToSQL="facebookUserToSQL.php",c.settings.addMessageService="addMessage.php",c.settings.getMediaService="getMedia.php",c.settings.createActivityService="createActivity.php",c.settings.getActivityUserService="getActivityUser.php",c.settings.setGoingToActivityService="setGoingToActivity.php",c.settings.getBuurtenService="getBuurten.php",c.settings.getLocationsService="getLocations.php",c.settings.addLocationService="addLocation.php",c.settings.getMyPlannedActivities="getMyPlannedActivities.php",c.settings.getMyActivities="getMyActivities.php",c.settings.getFavouriteSportsService="getFavouriteSports.php",c.settings.addFavouriteSportsService="addFavouriteSports.php",c.settings.getUserFavouriteSportsService="getUserFavouriteSports.php",c.settings.imageUploadService="uploadService.php",c.settings.addPhotoToDatabase="addPhotoToDatabase.php",c.settings.getMyAvatarService="getMyAvatar.php",c.settings.getUserChallengesService="getUserChallengesService.php",c.settings.updateAvatarService="updateAvatar.php",c.settings.getMyChallengesService="getMyChallenges.php",c.settings.joinChallengeService="joinChallenge.php",c.settings.getBadgesService="getBadges.php",c.settings.updateChallengeService="updateChallengeScore.php",c.settings.addSportService="addSport.php",c.settings.getFriendsService="getMyFriends.php",c.settings.addFriendService="addFriend.php",c.settings.getMyInvitationsService="getMyInvitations.php",c.settings.inviteFriendsService="inviteFriends.php",c.settings.handleInvitationsService="handleInvitation.php",c.settings.removeFriendService="removeFriend.php",c.settings.updateUserAvatarService="updateUserAvatar.php",c.settings.uploadMediaNonNativeService="uploadMediaNonNative.php",c.settings.updateActivityService="updateActivity.php",c.settings.getUserMediaService="getUserMedia.php",c.settings.getChallengesCount="getChallengesCount.php",c.settings.defaultLocation=[51.20935,3.2247],c.settings.dataLoaded=!1,c.settings.userLoggedIn=!1,c.messages.passwordIncorrect="Je paswoord is niet correct",c.messages.noUser="Er werd geen gebruiker met dit email adres gevonden, je kan <a href='#createUser'>hier</a> een nieuwe gebruiker aanmaken.",c.start=function(a){function b(){switch(window.orientation){case-90:case 90:$("#container").addClass("landscape").removeClass("portrait");break;default:$("#container").addClass("portrait").removeClass("landscape")}}function d(){$("#container").addClass("keyboard")}function e(){$("#container").removeClass("keyboard")}function f(){}function g(){$("#container").addClass("online").removeClass("offline"),c.settings.network=!0,Backbone.trigger("networkFoundEvent")}function h(){$("#container").removeClass("online").addClass("offline"),c.settings.network=!1,Backbone.trigger("networkLostEvent")}c.settings.native=a,$(document).ready(function(){c.router=new c.routers.AppRouter,c.utils.templates.load(["HomeView","DashboardView","PlannerView","ProfileView","ActivityDetailView","CreateActivityView","CreateUserView","NavigationView","SettingsView","SportSelectorView","DashboardActivityView","LoadingView","HelperView","ChallengeListView","ActivityMessageView","ActivityMessageView","ActivityInfoView","ActivityMediaView","ActivityMessagesView","ActivityMediaViewer","ActivityInfoView","CreateActivityLocationView","CreateActivityInfoView","CreateActivityWieView","ProfileAvatarView","ProfileChallengeView","ProfileFriendsView","FriendsListView","FriendView","ActivityUserView","PlannerMyActivitiesView","GoogleMapView","FavouriteSportListView","ActiveChallengeListView","BadgeListView","FriendInvitieView","PlannerInvitedActivitiesView","NoConnectionView","AvatarDisplayView","PlannerTimelineWrap","FavouriteSportListSettingView"],function(){if(c.models.userModel=new User,c.forms.sortOptions=[{title:"Datum"},{title:"Afstand"},{title:"Mijn Favoriete Sporten"}],c.collections.sortOptions=new SortOptionsCollection(c.forms.sortOptions),$("#mainMenu").mmenu({dragOpen:!1}),$("#menuAvatarSection").click(function(){window.location.hash="#profile"}),c.services.phpService=new c.services.PhpServices,c.events.getMessagesSuccesEvent=_.extend({},Backbone.Events),c.events.getSportsSuccesEvent=_.extend({},Backbone.Events),c.events.getChallengesSuccesEvent=_.extend({},Backbone.Events),c.events.getActivitiesSuccesEvent=_.extend({},Backbone.Events),c.events.getMyActivitiesSuccesEvent=_.extend({},Backbone.Events),c.events.userLoggedInEvent=_.extend({},Backbone.Events),c.events.userLoggedInErrorEvent=_.extend({},Backbone.Events),c.events.userLoggedInPasswordErrorEvent=_.extend({},Backbone.Events),c.events.createUserEvent=_.extend({},Backbone.Events),c.events.createUserErrorEvent=_.extend({},Backbone.Events),c.events.getUserFromFacebookIDEvent=_.extend({},Backbone.Events),c.events.getUsersSuccesEvent=_.extend({},Backbone.Events),c.events.facebookUserToSQLEvent=_.extend({},Backbone.Events),c.events.postMessageSuccesEvent=_.extend({},Backbone.Events),c.events.getMediaSuccesEvent=_.extend({},Backbone.Events),c.events.createActivityTabsEvent=_.extend({},Backbone.Events),c.events.activityUsersSuccesEvent=_.extend({},Backbone.Events),c.events.goinToActivitySuccesEvent=_.extend({},Backbone.Events),c.events.getBuurtenEvent=_.extend({},Backbone.Events),c.events.updateActivitiesEvent=_.extend({},Backbone.Events),c.events.getLocationsSuccesEvent=_.extend({},Backbone.Events),c.events.getLatLonEvent=_.extend({},Backbone.Events),c.services.facebookService=new c.services.FacebookServices,c.events.facebookLoginEvent=_.extend({},Backbone.Events),c.events.facebookLoginErrorEvent=_.extend({},Backbone.Events),c.events.facebookGetFriendsEvent=_.extend({},Backbone.Events),c.events.facebookGetFriendsErrorEvent=_.extend({},Backbone.Events),c.events.facebookGetProfileDataEvent=_.extend({},Backbone.Events),c.events.facebookGetProfileDataErrorEvent=_.extend({},Backbone.Events),c.services.utilService=new c.services.UtilServices,c.events.locationHomeEvent=_.extend({},Backbone.Events),c.events.locationCreateActivityEvent=_.extend({},Backbone.Events),c.services.avatarService=new c.services.AvatarService,c.services.challengeService=new c.services.CHallengeService,c.helpers.phonegapHelper=new c.views.HelperView,c.settings.native){if(c.settings.pictureSource=navigator.camera.PictureSourceType,c.settings.destinationType=navigator.camera.DestinationType,document.addEventListener("resume",f,!1),document.addEventListener("offline",h,!1),document.addEventListener("online",g,!1),document.addEventListener("showkeyboard",d,!1),document.addEventListener("hidekeyboard",e,!1),window.addEventListener("orientationchange",b),c.services.utilService.getNetworkConnection()?c.services.facebookService.facebookConnect():window.localStorage.getItem("userModel")||(window.location.hash="noconnection"),window.localStorage.getItem("userModel")){var a=JSON.parse(window.localStorage.getItem("userModel"));c.models.userModel=new User(a),c.settings.userLoggedIn=!0,c.settings.storageFound=!0,c.storage=JSON.parse(window.localStorage.getItem("collections"))}c.settings.rootPath="http://ultimedia.biz/watm/",c.settings.servicePath=c.settings.rootPath+"services/",c.settings.imagePath=c.settings.rootPath+"common/uploads/",c.settings.badgesPath=c.settings.rootPath+"common/badges/",c.settings.iconPath=c.settings.rootPath+"public/css/assets/",c.settings.sportsPath=c.settings.rootPath+"common/sports/",c.settings.promoPath=c.settings.rootPath+"common/promo/",c.settings.avatarPath=c.settings.rootPath+"/common/avatar/"}else c.settings.native=!1,c.services.facebookService.facebookConnect();Backbone.history.start()})})},Activity=Backbone.Model.extend({defaults:{messages:[],activity_id:"",date:"",description:"",location_id:"",location:"",media:[],sport_id:"",time:"",stopTime:"",title:"",user_id:"",buurt_id:"4",participants:"0",going:"",users:[],full:!1,updateActivity:!1,creator:""},initialize:function(){this.setGoing()},setGoing:function(){this.attributes.going=this.attributes.users.length,this.isFull()},isFull:function(){this.attributes.full=this.attributes.going>=this.attributes.participants?!0:!1}}),Avatar=Backbone.Model.extend({defaults:{female:{strength:["avatar_female_default.png","avatar_female_20.png","avatar_female_40.png","avatar_female_60.png","avatar_female_80.png","avatar_female_100.png"],equipment:["equipment_female_default.png","equipment_female_20.png","equipment_female_40.png","equipment_female_60.png","equipment_female_80.png","equipment_female_100.png"]},male:{strength:["avatar_male_default.png","avatar_male_20.png","avatar_male_40.png","avatar_male_60.png","avatar_male_80.png","avatar_male_100.png"],equipment:["equipment_male_default.png","equipment_male_20.png","equipment_male_40.png","equipment_male_60.png","equipment_male_80.png","equipment_male_100.png"]},strengthDisplay:"",equipmentDisplay:""},initialize:function(){}}),Buurten=Backbone.Model.extend({initialize:function(){}}),Challenge=Backbone.Model.extend({initialize:function(){}}),Location=Backbone.Model.extend({defaults:{description:"",location:"",coordinates:""},initialize:function(){},label:function(){return this.get("location")}}),Media=Backbone.Model.extend({initialize:function(){}}),Message=Backbone.Model.extend({initialize:function(){}}),SortOption=Backbone.Model.extend({initialize:function(){}}),Sport=Backbone.Model.extend({defaults:{object_class:""},initialize:function(){},label:function(){return this.get("sport_title")}}),User=Backbone.Model.extend({defaults:{user_id:"",name:"",email:"",gender:"1",facebook_data:{},facebookUser:!1,current_location:"50.827404, 3.254647",strength_score:0,stamina_score:0,equipment_score:0,avatar:"default.png",myChallenges:[],myBadges:[],age:[],myFavouriteSports:[]},initialize:function(){}}),ActivitiesCollection=Backbone.Collection.extend({model:Activity,sort_key:"distance",initialize:function(){this.sort_key="distance"},comparator:function(a,b){return a=a.get(this.sort_key),b=b.get(this.sort_key),a>b?1:b>a?-1:0},sort_by_attribute:function(a){this.sort_key=a,this.sort(),console.log(this)}}),BuurtenCollection=Backbone.Collection.extend({model:Buurten,initialize:function(){}}),ChallengesCollection=Backbone.Collection.extend({model:Challenge,initialize:function(){}}),LocationsCollection=Backbone.Collection.extend({model:Location,initialize:function(){}}),MediaCollection=Backbone.Collection.extend({model:Media,initialize:function(){}}),MessagesCollection=Backbone.Collection.extend({model:Message,initialize:function(){}}),SortOptionsCollection=Backbone.Collection.extend({model:SortOption,initialize:function(){}}),SportsCollection=Backbone.Collection.extend({model:Sport,initialize:function(){}}),UsersCollection=Backbone.Collection.extend({model:User,initialize:function(){}}),c.views.ActiveChallengeListView=Backbone.View.extend({className:"challenge-item",initialize:function(){this.model.attributes.badges_path=c.settings.badgesPath},render:function(){this.$el.html(this.template(this.model.attributes)),$(this.$el).hide().fadeIn(500);var a,b,c=0,d=0;this.model.attributes.status&&(this.model.attributes.status.sportsFilter&&(a=this.model.attributes.challengeData.sportsFilter.total,b=this.model.attributes.status.sportsFilter.count,c+=b/a*100,d++),this.model.attributes.status.activityCreateFilter&&(a=this.model.attributes.challengeData.activityCreateFilter.total,b=this.model.attributes.status.activityCreateFilter.count,c+=b/a*100,d++),this.model.attributes.status.fotoCreateFilter&&(a=this.model.attributes.challengeData.fotoCreateFilter.total,b=this.model.attributes.status.fotoCreateFilter.count,c+=b/a*100,d++),this.model.attributes.status.participateFilter&&(a=this.model.attributes.challengeData.participateFilter.total,b=this.model.attributes.status.participateFilter.count,c+=b/a*100,d++));var e=c/d;return $(".progress",this.$el).progressbar({value:e}),this}}),c.views.ActivityDetailView=Backbone.View.extend({initialize:function(){console.log("----- In the initialize of ActivityDetailView -----"),c.views.ActivityDetailView.model=this.model,c.views.ActivityDetailView.wallPostCompleteHandler=this.wallPostCompleteHandler,c.views.ActivityDetailView.addMap=this.addMap,Backbone.on("networkFoundEvent",this.networkFoundHandler),Backbone.on("networkLostEvent",this.networkLostHandler)},networkFoundHandler:function(){!c.settings.mapAdded&&c.services.utilService.getNetworkConnection()&&c.views.ActivityDetailView.addMap()},networkLostHandler:function(){},render:function(){this.$el.html(this.template(this.model.attributes)),c.settings.currentPageHTML=this.$el,this.currentActivityPage="#praktischContent";var a=new c.views.ActivityInfoView({model:c.views.ActivityDetailView.model});$("#activityContent",c.settings.currentPageHTML).empty().append(a.render().$el),c.models.userModel.get("user_id")==this.model.get("user_id")&&$("#editPanel",c.settings.currentPageHTML).removeClass("hide");$("#activityDetailTabs",c.settings.currentPageHTML).offset();return c.settings.mapAdded=!1,c.services.utilService.getNetworkConnection()&&c.settings.native?this.addMap():c.settings.native||this.addMap(),this.setValidators(),$("#ee",c.settings.currentPageHTML).delay(800).queue(function(){$(this).hide().css("display","block").textfill({max:22}).show()}),$(window).resize(_.debounce(function(){$("#ee",c.settings.currentPageHTML).textfill()},500)),this},shareButtonHandler:function(){},setValidators:function(){$("#messageForm",c.settings.currentPageHTML).validate({submitHandler:function(){var a=$("#messageInput",c.settings.currentPageHTML).val();$("#messageInput",c.settings.currentPageHTML).val(""),c.services.phpService.addMessage(a,c.views.ActivityDetailView.model.attributes.activity_id)}})},messageSubmitHandler:function(){$("#messageForm",c.settings.currentPageHTML).submit()},addMap:function(){c.settings.mapAdded=!0;var a,b={zoom:15,center:new google.maps.LatLng(14,10),mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0},d=new google.maps.Map($("#activityMap",c.settings.currentPageHTML)[0],b);if(this.model.attributes.coordinates){a=this.model.attributes.coordinates.split(",");{var e=new google.maps.MarkerImage(c.settings.iconPath+"open-icon@x2.png",null,null,null,new google.maps.Size(26,30));new google.maps.Marker({position:new google.maps.LatLng(a[0],a[1]),map:d,title:"Huidige locatie",icon:e,optimized:!1})}google.maps.event.addListenerOnce(d,"idle",function(){google.maps.event.trigger(d,"resize"),d.setCenter(new google.maps.LatLng(a[0],a[1]),13)})}},events:{"click #activityDetailTabs .cl-btn":"activeDetailTabsHandler","click #navigateButton":"navigateClickHandler","click #backButton":"backHandler","click #shareButton":"sharePopopverClickHandler","click #popover-close":"sharePopopverClickHandler","click #updateButton":"updateButtonClickHandler","click #facebookShareButton":"facebookShareButtonClickHandler","click #messageSubmit":"messageSubmitHandler","click .cl-modal-backdrop":"modalDrop"},modalDrop:function(){$("#popover",c.settings.currentPageHTML).addClass("hide")},facebookShareButtonClickHandler:function(){Backbone.on("FacebookWallPostCompleteEvent",c.views.ActivityDetailView.wallPostCompleteHandler),c.services.facebookService.facebookWallpost(c.views.ActivityDetailView.model)},wallPostCompleteHandler:function(){Backbone.off("FacebookWallPostCompleteEvent"),$("#popover",c.settings.currentPageHTML).addClass("hide")},updateButtonClickHandler:function(){window.location.hash="#update/"+c.views.ActivityDetailView.model.attributes.activity_id},sharePopopverClickHandler:function(){$("#popover",c.settings.currentPageHTML).toggleClass("hide")},backHandler:function(){window.history.back()},navigateClickHandler:function(){c.router.navigate("navigater",!0)},activeDetailTabsHandler:function(a){$("#activityDetailTabs .cl-btn").removeClass("active"),$(a.target,c.settings.currentPageHTML).addClass("active");var b,d=$(a.target,c.settings.currentPageHTML).attr("data");switch(clearInterval(c.settings.timer),$("#messageBox",c.settings.currentPageHTML).removeClass("open"),d){case"#praktischContent":b=new c.views.ActivityInfoView({model:c.views.ActivityDetailView.model});break;case"#mediaContent":b=new c.views.ActivityMediaView({model:c.views.ActivityDetailView.model});break;case"#messagesContent":b=new c.views.ActivityMessagesView({model:c.views.ActivityDetailView.model}),$("#messageBox",c.settings.currentPageHTML).addClass("open")}$("#activityContent",c.settings.currentPageHTML).empty().append(b.render().$el),this.currentActivityPage=d}}),c.views.ActivityInfoView=Backbone.View.extend({initialize:function(){c.events.goinToActivitySuccesEvent.bind("goingToActivitySuccesHandler",this.goingToActivitySuccesHandler),c.models.activityModel=this.model,Backbone.on("activityUsersSuccesEvent",this.getActivityUsersSuccesHandler),Backbone.on("goinToActivitySuccesEvent",this.setGoingToActivityCompleteHandler),c.views.ActivityInfoView.model=this.model,c.settings.native?c.services.utilService.getNetworkConnection()?c.services.phpService.getActivityUsers(this.model):$("#createActivityButton").hide():c.services.phpService.getActivityUsers(this.model),Backbone.on("networkFoundEvent",this.networkFoundHandler),Backbone.on("networkLostEvent",this.networkLostHandler),c.settings.timer=setInterval(c.services.phpService.getActivityUsers(this.model),1e4)},networkFoundHandler:function(){c.services.phpService.getActivityUsers(this.model)},networkLostHandler:function(){},render:function(){if(this.model.attributes.user_id){var a=c.collections.users.where({user_id:this.model.attributes.user_id})[0];a&&(this.model.attributes.creator=a.attributes.name)}this.$el.html(this.template(this.model.attributes)),c.settings.currentModuleHTML=this.$el;var b=this.model;return $('#praktischContent .radio-list input[type="radio"]',this.$el).change(function(){$(this).parents(".radio-list").find("label").removeClass("checked"),$(this).parent().addClass("checked");var a=$(this).attr("id");if(a=a.split("-"),a=a[1],c.services.phpService.setGoingToActivity(c.models.activityModel.attributes.activity_id,a),1==a){c.services.challengeService.checkChallenges(c.models.userModel,!0,!1,!1,!0,c.models.activityModel);var d=c.services.utilService.convertDate(b.attributes.savedDate,b.attributes.startTime,!0);c.settings.native&&window.plugin.notification.local.add({id:b.attributes.activity_id,title:b.attributes.title+" gaat beginnen",message:"Haast je snel naar "+b.attributes.location,date:d,autoCancel:!0})}else c.settings.native&&window.plugin.notification.local.cancel(b.attributes.activity_id,function(){})}),$("#messageBox",c.settings.currentPageHTML).addClass("hide"),this},setGoingToActivityCompleteHandler:function(){c.services.phpService.getActivityUsers(c.views.ActivityInfoView.model)},getActivityUsersSuccesHandler:function(a){c.models.activityModel.userData=new UsersCollection(a);var b=c.models.activityModel.userData.where({user_id:c.models.userModel.attributes.user_id.toString()});b=b[0],b?($("#praktischContent .radio-list label").removeClass("checked"),$("#going-"+b.attributes.going,c.settings.currentModuleHTML).parent().addClass("checked"),$("#going-"+b.attributes.going,c.settings.currentModuleHTML).prop("checked",!0)):($("#praktischContent .radio-list label").removeClass("checked"),$("#going-0",c.settings.currentModuleHTML).parent().addClass("checked"),$("#going-0",c.settings.currentModuleHTML).prop("checked",!0)),$("#aanwezigContent").empty(),c.views.ActivityInfoView.userListView=[],c.views.ActivityDetailView.model.attributes.users=a;var d=_(c.views.ActivityDetailView.model.attributes.users).where({going:"1"});$(d).each(function(a,b){c.views.ActivityInfoView.userListView.push(new c.views.ActivityUserView({model:b})),c.views.ActivityDetailView.model.attributes.going=d.length,c.views.ActivityDetailView.model.isFull(),$("#aanwezigContent",c.settings.currentModuleHTML).empty(),_(c.views.ActivityInfoView.userListView).each(function(a){$("#aanwezigContent",c.settings.currentModuleHTML).append(a.render().$el)})});var e=!1;b&&(e=0==b.attributes.going?!1:!0),c.views.ActivityInfoView.userListView.length>=parseInt(c.views.ActivityDetailView.model.attributes.participants)&&!e?($("#goingList",c.settings.currentModuleHTML).hide(),$("#goingFullMessage",c.settings.currentModuleHTML).fadeIn(400)):b?($("#goingList",c.settings.currentModuleHTML).fadeIn(400),$("#goingFullMessage",c.settings.currentModuleHTML).hide()):($("#goingFullMessage",c.settings.currentModuleHTML).hide(),$("#goingList",c.settings.currentModuleHTML).fadeIn(400)),$("#participantStat",c.settings.currentModuleHTML).text(c.views.ActivityInfoView.userListView.length+" / "+c.views.ActivityDetailView.model.attributes.participants)}}),c.views.ActivityMediaViewer=Backbone.View.extend({initialize:function(){},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),c.views.ActivityMessageView=Backbone.View.extend({initialize:function(){c.events.getMessagesSuccesEvent.bind("chatMessagesLoadSuccesHandler",this.chatMessagesLoadSuccesHandler),c.events.postMessageSuccesEvent.bind("postMessageSuccesHandler",this.postMessageSuccesHandler)},render:function(){return this.$el.html(this.template({user:this.model.attributes,imagePath:c.settings.imagePath})),this}}),c.views.ActivityMessagesView=Backbone.View.extend({initialize:function(){c.events.postMessageSuccesEvent.bind("postMessageSuccesHandler",this.postMessageSuccesHandler),Backbone.on("getMessages",this.chatMessagesLoadSuccesHandler),c.services.phpService.getMessages(this.model),c.views.ActivityMessagesView.messagesLoaded=this.chatMessagesLoadSuccesHandler,c.views.ActivityMessagesView.model=this.model,c.settings.timer=setInterval(this.timerAction,2e3)},timerAction:function(){Backbone.on("getMessages",c.views.ActivityMessagesView.messagesLoaded),c.services.phpService.getMessages(c.views.ActivityMessagesView.model)},render:function(){return this.$el.html(this.template(this.model.attributes)),c.settings.currentModuleHTML=this.$el,this},postMessageSuccesHandler:function(){$("#messageInput",c.settings.currentModuleHTML).val(""),c.services.phpService.getMessages(c.views.ActivityDetailView.model),c.services.utilService.updateLocalStorage()},chatMessagesLoadSuccesHandler:function(a){Backbone.off("getMessages"),c.views.ActivityDetailView.model.attributes.messages=a,c.views.ActivityDetailView.model.attributes.messages.length>0&&(c.views.ActivityDetailView.messagesListView=[],c.views.ActivityDetailView.model.attributes.messages.each(function(a){c.views.ActivityDetailView.messagesListView.push(new c.views.ActivityMessageView({model:a}))}),$("#messagesContent ul",c.settings.currentModuleHTML).empty(),_(c.views.ActivityDetailView.messagesListView).each(function(a){$("#messagesContent ul",c.settings.currentModuleHTML).append(a.render().$el)}))}}),c.views.ActivityUserView=Backbone.View.extend({initialize:function(){},render:function(){return this.model.imagePath=c.settings.imagePath,this.$el.html(this.template(this.model)),this}}),c.views.ActivityMediaView=Backbone.View.extend({className:"mediaContainer",initialize:function(){c.services.phpService.getMedia(this.model),c.views.ActivityMediaView.model=this.model,c.views.ActivityMediaView.fileUploadedHandler=this.fileUploadedHandler,c.views.ActivityMediaView.addPhotoToDatabaseHandler=this.addPhotoToDatabaseHandler,c.views.ActivityMediaView.win=this.win,c.views.ActivityMediaView.mediaLoaded=this.getMediaLoadSuccesHandler,c.views.ActivityMediaView.model=this.model,Backbone.on("mediaLoadSuccesHandler",c.views.ActivityMediaView.mediaLoaded),c.settings.timer=setInterval(this.timerAction,4e3)},timerAction:function(){Backbone.on("mediaLoadSuccesHandler",c.views.ActivityMediaView.mediaLoaded),c.services.phpService.getMedia(c.views.ActivityMediaView.model)},events:{"click #addMediaButton":"capturePhotoEditHandler","change #nonNativeFileField":"nonNativeFileSelectedHandler","submit #mediaForm":"mediaFormSubmitHandler"},getMediaLoadSuccesHandler:function(a){console.log("media loaded"),Backbone.off("mediaLoadSuccesHandler"),c.views.ActivityDetailView.mediaListView=[],c.views.ActivityDetailView.model.attributes.media=a,c.views.ActivityDetailView.model.attributes.media.each(function(a){var b=c.collections.users.where({user_id:a.attributes.user_id});b&&(b=b[0],a.attributes.userModel=b.attributes,a.attributes.url=a.attributes.url,a.attributes.imagePath=c.settings.imagePath,c.views.ActivityDetailView.mediaListView.push(new c.views.ActivityMediaViewer({model:a})))}),$("#mediaContenList",c.settings.currentModuleHTML).empty(),_(c.views.ActivityDetailView.mediaListView).each(function(a){$("#mediaContenList",c.settings.currentModuleHTML).append(a.render().$el)})},render:function(){return this.$el.html(this.template(this.model.attributes)),c.settings.currentModuleHTML=this.$el,c.settings.native||$("#addMediaButton",c.settings.currentModuleHTML).click(function(){return $("#nonNativeFileField",c.settings.currentModuleHTML).trigger("click"),!1}),this},mediaFormSubmitHandler:function(a){a.stopPropagation(),a.preventDefault();var b=new FormData;$.each(c.views.ActivityMediaView.files,function(a,c){b.append(a,c)}),Backbone.on("fileUploadedEvent",c.views.ActivityMediaView.fileUploadedHandler),c.services.phpService.uploadMediaNonNative(b)},nonNativeFileSelectedHandler:function(a){var b=a.target.files;c.views.ActivityMediaView.files=b,$("#mediaForm",c.settings.currentModuleHTML).submit()},fileUploadedHandler:function(a){Backbone.off("fileUploadedEvent");var b=a.files[0].replace(/^.*[\\\/]/,"");Backbone.on("addPhotoToDatabaseHandler",c.views.ActivityMediaView.addPhotoToDatabaseHandler),c.services.phpService.addPhotoToDatabase(b,c.views.ActivityMediaView.model.attributes.activity_id)},capturePhotoEditHandler:function(){this.$el;navigator.camera.getPicture(this.uploadPhoto,function(){},{quality:50,targetWidth:640,targetHeight:480,destinationType:navigator.camera.DestinationType.FILE_URI,sourceType:navigator.camera.PictureSourceType.CAMERA})},uploadPhoto:function(a){var b=new FileUploadOptions;b.fileKey="file",b.fileName=a.substr(a.lastIndexOf("/")+1),b.mimeType="image/jpeg";var d=new Object;d.value1=b.fileName,c.views.ActivityMediaView.uploadedPhotoUrl=b.fileName,b.params=d,b.chunkedMode=!1;var e=new FileTransfer;e.upload(a,c.settings.servicePath+c.settings.imageUploadService,c.views.ActivityMediaView.win,null,b)},win:function(){Backbone.on("addPhotoToDatabaseHandler",c.views.ActivityMediaView.addPhotoToDatabaseHandler),c.services.phpService.addPhotoToDatabase(c.views.ActivityMediaView.uploadedPhotoUrl,c.views.ActivityMediaView.model.attributes.activity_id)},addPhotoToDatabaseHandler:function(){Backbone.off("addPhotoToDatabaseHandler"),c.services.challengeService.checkChallenges(c.models.userModel,!1,!1,!0,!1),Backbone.on("mediaLoadSuccesHandler",c.views.ActivityMediaView.mediaLoaded),c.services.phpService.getMedia(c.views.ActivityMediaView.model),c.services.utilService.updateLocalStorage()}}),c.views.AvatarDisplayView=Backbone.View.extend({tagName:"span",className:"avatar-container",initialize:function(){},render:function(){return this.$el.html(this.template({avatarPath:c.settings.avatarPath,avatar:this.model.toJSON()})),$(this.$el).hide().show(500),this}}),c.views.BadgeListView=Backbone.View.extend({className:"badge-container",initialize:function(){this.model.attributes.badges_path=c.settings.badgesPath},render:function(){return this.$el.html(this.template(this.model.attributes)),this}}),c.views.ChallengeListView=Backbone.View.extend({className:"challenge-item",initialize:function(){this.model.attributes.badges_path=c.settings.badgesPath},render:function(){return this.$el.html(this.template(this.model.attributes)),c.views.ChallengeListView.my=this.$el,$(this.$el).hide().fadeIn(500),this},events:{"click .joinChallenge":"joinChallengeClickHandler"},joinChallengeClickHandler:function(a){c.services.phpService.joinChallenge($(a.target).attr("challenge-id")),$(c.views.ChallengeListView.my).hide(300)}}),c.views.CreateActivityInfoView=Backbone.View.extend({initialize:function(){c.views.CreateActivityInfoView.addedSportHandler=this.addedSportHandler},render:function(){this.$el.html(this.template()),c.settings.currentModuleHTML=this.$el,c.views.CreateActivityInfoView.sportAutComplete=new AutoCompleteView({input:$("#sportInput",c.settings.currentModuleHTML),model:c.collections.sports,wait:100,updateModel:c.views.ActivityDetailView.model,updateID:"sport_id"}).render(),this.setValidator();var a=new Date,b=a.getMinutes(),d=Math.round(b/15);4==d&&a.setHours(a.getHours()+1);var e=15*d%60;a.setMinutes(e);var f=("0"+a.getMinutes()).slice(-2),g=("0"+a.getHours()).slice(-2);$("#vanInput",c.settings.currentModuleHTML).val(g+":"+f);var h=a.getHours()+1;h=("0"+h).slice(-2),$("#totInput",c.settings.currentModuleHTML).val(g+":"+f);var i=g+":"+f,j=i.split(":");if($("#totInput",c.settings.currentModuleHTML).val(parseInt(j[0])+1+":"+j[1]),c.views.CreateActivityView.isUpdating){var k=c.collections.sports.where({sport_id:c.views.ActivityDetailView.model.attributes.sport_id});k=k[0],$("#sportInput",c.settings.currentModuleHTML).val(k.attributes.sport_title),$("#participantsSlider",c.settings.currentModuleHTML).attr("value",c.views.ActivityDetailView.model.attributes.participants),this.participantsSliderHandler(),$("#titelInput",c.settings.currentModuleHTML).val(c.views.ActivityDetailView.model.attributes.title);var l=c.views.ActivityDetailView.model.attributes.date.slice(-5);$("#vanInput",c.settings.currentModuleHTML).val(l),$("#totInput",c.settings.currentModuleHTML).val(c.views.ActivityDetailView.model.attributes.stopTime),$("#omschrijvingInput",c.settings.currentModuleHTML).val(c.views.ActivityDetailView.model.attributes.description);var m=new Date(c.views.ActivityDetailView.model.attributes.savedDate);$("#wanneerInput",c.settings.currentModuleHTML).val(m.toDateInputValue())}return this},events:{"change #participantsSlider":"participantsSliderHandler","change #vanInput":"timeChangeHandler"},timeChangeHandler:function(){var a=$("#vanInput",c.settings.currentModuleHTML).val(),b=a.split(":");$("#totInput",c.settings.currentModuleHTML).val(parseInt(b[0])+1+":"+b[1])},participantsSliderHandler:function(){$("#participants",c.settings.currentModuleHTML).removeClass("hide").text($("#participantsSlider",c.settings.currentModuleHTML).val())},subHandler:function(){$("#watForm",c.settings.currentModuleHTML).submit()},addedSportHandler:function(a){Backbone.off("addedSportHandler"),c.views.ActivityDetailView.model.attributes.sport_id=a.sport_id,c.events.createActivityTabsEvent.trigger("formStageCompleteEvent",c.views.CreateActivityInfoView.tabTarget)},setValidator:function(){$("#wanneerInput",c.settings.currentModuleHTML).val((new Date).toDateInputValue()),$("#watForm",c.settings.currentModuleHTML).validate({rules:{wanneerInput:{date:!0},participants:{required:!0,range:[2,60]}},submitHandler:function(){c.views.ActivityDetailView.model.attributes.participants=$("#participantsSlider",c.settings.currentModuleHTML).val(),c.views.ActivityDetailView.model.attributes.title=$("#titelInput",c.settings.currentModuleHTML).val(),c.views.ActivityDetailView.model.attributes.date=$("#wanneerInput",c.settings.currentModuleHTML).val()+" "+$("#vanInput",c.settings.currentModuleHTML).val(),c.views.ActivityDetailView.model.attributes.stopTime=$("#totInput",c.settings.currentModuleHTML).val(),c.views.ActivityDetailView.model.attributes.description=$("#omschrijvingInput",c.settings.currentModuleHTML).val(),c.views.CreateActivityInfoView.tabTarget={},c.views.CreateActivityInfoView.tabTarget.location="#waarContent",c.views.CreateActivityInfoView.tabTarget.tab="#waarTab";
var a=c.collections.sports.where({sport_id:c.views.ActivityDetailView.model.attributes.sport_id});a.length>0?(a=a[0],a.attributes.sport_title==$("#sportInput",c.settings.currentModuleHTML).val()?c.events.createActivityTabsEvent.trigger("formStageCompleteEvent",c.views.CreateActivityInfoView.tabTarget):(Backbone.on("addedSportHandler",c.views.CreateActivityInfoView.addedSportHandler),c.services.phpService.addSport($("#sportInput",c.settings.currentModuleHTML).val(),"",""))):(Backbone.on("addedSportHandler",c.views.CreateActivityInfoView.addedSportHandler),c.services.phpService.addSport($("#sportInput",c.settings.currentModuleHTML).val(),"",""))}})}}),c.views.CreateActivityLocationView=Backbone.View.extend({initialize:function(){c.events.locationCreateActivityEvent.bind("locationSuccesHandler",this.locationSuccesHandler),c.events.locationCreateActivityEvent.bind("locationErrorHandler",this.locationErrorHandler),c.events.getLatLonEvent.bind("getLatLonSuccesHandler",this.getLatLonSuccesHandler),Backbone.on("addedLocationSuccesEvent",this.addedLocationSuccesEvent),this.currentMapLocation="",this.wait=!1,c.views.CreateActivityLocationView.setMarkers=this.setMarkers,c.views.CreateActivityLocationView.tabTarget={},c.views.CreateActivityLocationView.tabTarget.location="#wieContent",c.views.CreateActivityLocationView.tabTarget.tab="#wieTab",c.views.CreateActivityLocationView.markers=[],c.views.CreateActivityLocationView.clearMarkers=this.clearMarkers,c.views.CreateActivityLocationView.activityCreatedHandler=this.activityCreatedHandler},events:{"keyup #locationInput":"locationChangeHandler"},getLatLonSuccesHandler:function(a){a&&a.geometry&&(c.views.CreateActivityLocationView.currentMapLocation=a.geometry.location.lat+","+a.geometry.location.lng,c.views.CreateActivityLocationView.setMarkers(a.geometry.location.lat,a.geometry.location.lng,a.formatted_address))},locationChangeHandler:function(){if($("#locationInput",c.settings.currentModuleHTML).val().length>3)if(c.views.ActivityDetailView.model.attributes.location_id){var a=c.collections.locations.where({location_id:c.views.ActivityDetailView.model.attributes.location_id});if(a){a=a[0];var b=a.attributes.coordinates.split(",");c.views.CreateActivityLocationView.currentLocation=b,c.views.CreateActivityLocationView.map.setCenter(new google.maps.LatLng(b[0],b[1]),13),console.log(a),a.location==$("#locationInput",c.settings.currentModuleHTML).val()||a.attributes.location==$("#locationInput",c.settings.currentModuleHTML).val()||(c.views.ActivityDetailView.model.attributes.location_id=null,c.services.utilService.getLatLon($("#locationInput").val()))}}else c.services.utilService.getLatLon($("#locationInput").val())},setMarkers:function(a,b,d){c.views.CreateActivityLocationView.clearMarkers(),c.views.CreateActivityLocationView.map.setCenter(new google.maps.LatLng(a,b),13);var e=new google.maps.MarkerImage(c.settings.iconPath+"open-icon@x2.png",null,null,null,new google.maps.Size(26,30)),f=new google.maps.Marker({position:new google.maps.LatLng(a,b),map:c.views.CreateActivityLocationView.map,title:d,icon:e,optimized:!1});d&&c.views.CreateActivityLocationView.infowindow.setContent("ddddddddd"),c.views.CreateActivityLocationView.map.setCenter(new google.maps.LatLng(a,b),13),google.maps.event.addListener(f,"click",function(){c.views.CreateActivityLocationView.infowindow.open(c.views.CreateActivityLocationView.map,f)}),c.views.CreateActivityLocationView.markers.push(f),c.views.CreateActivityLocationView.infowindow.setContent(d)},clearMarkers:function(){for(var a=0;a<c.views.CreateActivityLocationView.markers.length;a++)c.views.CreateActivityLocationView.markers[a].setVisible(!1);c.views.CreateActivityLocationView.markers=[]},addedLocationSuccesEvent:function(a){c.views.ActivityDetailView.model.attributes.location_id=a,c.views.CreateActivityView.updating?(Backbone.on("activityUpdated",c.views.CreateActivityLocationView.activityCreatedHandler),c.services.phpService.updateActivity(c.views.ActivityDetailView.model)):(Backbone.on("activityCreated",c.views.CreateActivityLocationView.activityCreatedHandler),c.services.phpService.createActivity(c.views.ActivityDetailView.model))},render:function(){return this.$el.html(this.template()),c.settings.currentModuleHTML=this.$el,c.views.CreateActivityLocationView.locationAutComplete=new AutoCompleteView({input:$("#locationInput",c.settings.currentModuleHTML),model:c.collections.locations,wait:100,updateModel:c.views.ActivityDetailView.model,updateID:"location_id",onSelect:function(){var a=c.collections.locations.where({location_id:c.views.ActivityDetailView.model.attributes.location_id})[0],b=a.attributes.coordinates.split(","),d=a.attributes.location;c.views.CreateActivityLocationView.currentLocation=b,c.views.CreateActivityLocationView.setMarkers(b[0],b[1],d)}}).render(),this.setValidators(),this.initMap(),c.views.CreateActivityView.updating&&($("#locationInput",c.settings.currentModuleHTML).val(c.views.ActivityDetailView.model.attributes.location),this.locationChangeHandler()),this},initMap:function(){c.settings.mapAdded=!0;var a={zoom:15,center:new google.maps.LatLng(c.settings.defaultLocation[0],c.settings.defaultLocation[1]),mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0},b=this.$el;if(c.views.CreateActivityLocationView.map=new google.maps.Map($("#map_canvas",b)[0],a),c.views.CreateActivityLocationView.infowindow=new google.maps.InfoWindow,c.models.userModel.attributes.current_location){var d=c.models.userModel.attributes.current_location.split(",");c.views.CreateActivityLocationView.currentLocation=[],c.views.CreateActivityLocationView.currentLocation.push(d[0]),c.views.CreateActivityLocationView.currentLocation.push(d[1])}else c.views.CreateActivityLocationView.currentLocation=[],c.views.CreateActivityLocationView.currentLocation.push(51.20935),c.views.CreateActivityLocationView.currentLocation.push(3.2247);google.maps.event.addListenerOnce(c.views.CreateActivityLocationView.map,"idle",function(){google.maps.event.trigger(c.views.CreateActivityLocationView.map,"resize"),c.views.CreateActivityLocationView.map.setCenter(new google.maps.LatLng(c.views.CreateActivityLocationView.currentLocation[0],c.views.CreateActivityLocationView.currentLocation[1]),13)}),google.maps.event.addListener(c.views.CreateActivityLocationView.map,"click",function(){}),c.settings.native&&c.services.utilService.getLocationService("createActivity")},locationSuccesHandler:function(a){c.views.CreateActivityLocationView.setMarkers(a.coords.latitude,a.coords.longitude)},locationErrorHandler:function(){},setValidators:function(){$("#waarForm",c.settings.currentModuleHTML).validate({submitHandler:function(){c.views.ActivityDetailView.model.attributes.location=$("#locationInput",c.settings.currentModuleHTML).val();var a=c.collections.locations.findWhere({location:$("#locationInput",c.settings.currentModuleHTML).val()});a?c.views.CreateActivityView.updating?(Backbone.on("activityUpdated",c.views.CreateActivityLocationView.activityCreatedHandler),c.services.phpService.updateActivity(c.views.ActivityDetailView.model)):(Backbone.on("activityCreated",c.views.CreateActivityLocationView.activityCreatedHandler),c.services.phpService.createActivity(c.views.ActivityDetailView.model)):c.services.phpService.addLocation($("#locationInput",c.settings.currentModuleHTML).val(),c.views.CreateActivityLocationView.currentMapLocation,"")}})},activityCreatedHandler:function(a){Backbone.off("activityCreated"),Backbone.off("activityUpdated"),c.views.CreateActivityView.updating=!1,c.views.CreateActivityView.isUpdating=!1,c.views.CreateActivityLocationView.activity_id=a,c.services.phpService.getActivities(!1,c.views.CreateActivityLocationView.activity_id),c.settings.created=!0,c.services.utilService.updateLocalStorage()}}),c.views.CreateActivityView=Backbone.View.extend({initialize:function(){this.model?this.model.attributes.updateActivity?(c.views.CreateActivityView.updating=this.model.attributes.updateActivity,c.views.ActivityDetailView.model=this.model,c.views.CreateActivityView.isUpdating=!0):(c.views.ActivityDetailView.model=new Activity,c.views.CreateActivityView.isUpdating=!1):(c.views.ActivityDetailView.model=new Activity,c.views.CreateActivityView.isUpdating=!1),c.events.createActivityTabsEvent.bind("formStageCompleteEvent",this.formStageCompleteEvent),Backbone.on("networkFoundEvent",this.networkFoundHandler),Backbone.on("networkLostEvent",this.networkLostHandler)},menuOpenHandler:function(){$("#mainMenu").trigger("open")},networkFoundHandler:function(){},networkLostHandler:function(){},render:function(){this.$el.html(this.template()),this.currentActivityPage="#watContent",c.settings.currentPageHTML=this.$el;var a=new c.views.CreateActivityInfoView({model:c.views.ActivityDetailView.model});return $("#createActivityContent",c.settings.currentPageHTML).empty().append(a.render().$el),0===c.models.userModel.attributes.myFriends.models.length&&$("#wieTab",c.settings.currentPageHTML).addClass("hide"),c.views.CreateActivityView.isUpdating&&($(".cl-title",c.settings.currentPageHTML).text("Wijzig activitiet"),$("#backButton",c.settings.currentPageHTML).removeAttr("style"),$("#menuButton",c.settings.currentPageHTML).hide()),this},events:{"click #submitButton":"subHandler","click #menuButton":"menuOpenHandler","click #watTab":"previousTabHandler","click #backButton":"backHandler"},backHandler:function(){window.history.back()},previousTabHandler:function(){},subHandler:function(){$("form").is("#wieForm")?c.views.CreateActivityView.updating?(Backbone.on("activityUpdated",c.views.CreateActivityLocationView.activityCreatedHandler),c.services.phpService.updateActivity(c.views.ActivityDetailView.model)):(Backbone.on("activityCreated",c.views.CreateActivityLocationView.activityCreatedHandler),c.services.phpService.createActivity(c.views.ActivityDetailView.model)):$("form",c.settings.currentPageHTML).submit()},formStageCompleteEvent:function(a){var b=a.location,d=a.tab;$("#createActivityTabs a").removeClass("active"),$(d,c.settings.currentPageHTML).addClass("active"),$(this.currentActivityPage,c.settings.currentPageHTML).removeClass("show").addClass("hide"),$(b,c.settings.currentPageHTML).removeClass("hide").addClass("show"),this.currentActivityPage=b;var e;switch(b){case"#watContent":e=new c.views.CreateActivityInfoView({model:c.views.ActivityDetailView.model});break;case"#waarContent":e=new c.views.CreateActivityLocationView({model:c.views.ActivityDetailView.model}),0===c.models.userModel.attributes.myFriends.models.length&&$("#submitButton").val(c.views.CreateActivityView.isUpdating?"Activiteit bijwerken":"Activiteit aanmaken");break;case"#wieContent":e=new c.views.CreateActivityWieView({model:c.views.ActivityDetailView.model}),$("#submitButton").val(c.views.CreateActivityView.isUpdating?"Activiteit bijwerken":"Activiteit aanmaken")}$("#createActivityContent",c.settings.currentPageHTML).empty().append(e.render().$el)}}),c.views.CreateActivityWieView=Backbone.View.extend({initialize:function(){c.views.friendsListView=[],c.collections.selectedFriends=new UsersCollection,c.views.CreateActivityWieView.activityCreatedHandler=this.activityCreatedHandler,c.views.CreateActivityWieView.friendsInvitedHandler=this.friendsInvitedHandler,$(c.models.userModel.attributes.myFriends.models).each(function(a,b){c.views.friendsListView.push(new c.views.FriendInvitieView({model:b}))})},render:function(){return this.$el.html(this.template(this.model.attributes)),c.settings.currentModuleHTML=this.$el,_(c.views.friendsListView).each(function(a){$("#friendsList",c.settings.currentModuleHTML).append(a.render().$el)}),this.setValidator(),this},setValidator:function(){},activityCreatedHandler:function(a){Backbone.off("activityCreated"),Backbone.off("activityUpdated"),c.views.CreateActivityView.updating=!1,c.views.CreateActivityView.isUpdating=!1,c.views.CreateActivityWieView.activity_id=a,c.collections.selectedFriends.length>0?(Backbone.on("friendsInvitedHandler",c.views.CreateActivityWieView.friendsInvitedHandler),c.services.phpService.inviteFriends(c.collections.selectedFriends,a)):c.services.phpService.getActivities(!1,c.views.CreateActivityWieView.activity_id),c.settings.created=!0,c.services.utilService.updateLocalStorage()},friendsInvitedHandler:function(){Backbone.off("friendsInvitedHandler"),c.services.phpService.getActivities(!1,c.views.CreateActivityWieView.activity_id)}}),c.views.CreateUserView=Backbone.View.extend({initialize:function(){c.events.createUserErrorEvent.bind("createUserErrorHandler",this.createUserErrorHandler),c.events.locationHomeEvent.bind("locationErrorHandler",this.locationErrorHandler),c.views.CreateUserView.selectedGender=0,c.views.CreateUserView.locationErrorHandler=this.locationErrorHandler,c.views.CreateUserView.locationSuccesHandler=this.locationSuccesHandler,c.views.CreateUserView.createUserHandler=this.createUserHandler},render:function(){return this.$el.html(this.template()),c.settings.currentPageHTML=this.$el,this.setValidator(),this.model&&($("#passwordInput",c.settings.currentPageHTML).val(this.model.attributes.password),$("#emailInput",c.settings.currentPageHTML).val(this.model.attributes.email)),$('.radio-list input[type="radio"]',c.settings.currentPageHTML).change(function(){$(this).parents(".radio-list").find("label").removeClass("checked"),$(this).parent().addClass("checked");var a=$(this).attr("id");a=a.split("-"),a=a[1],c.views.CreateUserView.selectedGender=a}),this},events:{"click #createUserButton":"createUserButtonHandler","change #ageSlider":"ageSliderHandler"},ageSliderHandler:function(){$("#range",c.settings.currentPageHTML).removeClass("hide").text($("#ageSlider",c.settings.currentPageHTML).val()+" jaar")},createUserButtonHandler:function(){$("#createUserForm",c.settings.currentPageHTML).submit()},createUserHandler:function(){Backbone.off("createUserHandler"),c.router.navigate("dashboard",!0)},createUserErrorHandler:function(){alert("cannot create user")},setValidator:function(){$("#createUserForm",c.settings.currentPageHTML).validate({rules:{password:{minlength:4},age:{required:!0,range:[12,60]}},messages:{genderradios:"Kies een optie"},errorPlacement:function(a,b){a.insertAfter("genderradios"==b.attr("name")?"#genderSelect":b)},submitHandler:function(){var a=$("#nameInput",c.settings.currentPageHTML).val(),b=$("#passwordInput",c.settings.currentPageHTML).val(),d=$("#emailInput",c.settings.currentPageHTML).val(),e=c.views.CreateUserView.selectedGender,f=$("#ageSlider",c.settings.currentPageHTML).val();c.models.userModel=new User,c.models.userModel.set("name",a),c.models.userModel.set("email",d),c.models.userModel.set("password",b),c.models.userModel.set("age",f),c.models.userModel.set("gender",e),navigator.geolocation?($("#facebookLoad").removeClass("hide"),Backbone.on("createUserLocationHandler",c.views.CreateUserView.locationSuccesHandler),c.services.utilService.getLocationService("create")):(Backbone.on("createUserHandler",c.views.CreateUserView.createUserHandler),c.services.phpService.createUser())}})},locationSuccesHandler:function(a){var b=a.coords.latitude+","+a.coords.longitude;c.models.userModel.attributes.current_location=b,Backbone.on("createUserHandler",c.views.CreateUserView.createUserHandler),c.services.phpService.createUser()},locationErrorHandler:function(){Backbone.off("locationError"),Backbone.on("createUserHandler",c.views.CreateUserView.createUserHandler),c.services.phpService.createUser()}}),c.views.DashboardActivityView=Backbone.View.extend({initialize:function(){},events:{"click .activityContainer":"clickHandler"},clickHandler:function(){window.location.hash="#activity/"+this.model.attributes.activity_id},render:function(){var a=this.model.attributes.user_id,b="",d="";if(a){var e=c.collections.users.where({user_id:this.model.attributes.user_id})[0];b=e.attributes.name,d=e.attributes.user_id}return this.$el.html(this.template({username:b,userid:d,activity:this.model.toJSON(),imagePath:c.settings.imagePath,users:this.model.attributes.users,userModel:c.models.userModel.toJSON()})),this}}),c.views.DashboardView=Backbone.View.extend({initialize:function(){this.searching=!1,this.favouriteSportsFilter=!1,c.events.updateActivitiesEvent.bind("activitiesUpdateHandler",this.activitiesUpdateHandler),c.collections.activities.sort_by_attribute("sql_index"),Backbone.on("dashboardUpdatedHandler",this.generateAcitvitiesCollection),c.views.DashboardView.markers=[],c.views.DashboardView.clearMarkers=this.clearMarkers,c.views.DashboardView.setMarkers=this.setMarkers,c.views.DashboardView.initMap=this.initMap,c.views.DashboardView.generateAcitvitiesCollection=this.generateAcitvitiesCollection,c.views.DashboardView.firstRet=!0,c.views.DashboardView.filterEnabled=!1,c.views.DashboardView.sortActivitiesChangeHandler=this.sortActivitiesChangeHandler,c.settings.native?c.services.utilService.getNetworkConnection()&&c.services.phpService.getActivities(!1,null):c.services.phpService.getActivities(!1,null),c.settings.timer=setInterval(this.timerAction,4e3),Backbone.on("networkFoundEvent",this.networkFoundHandler),Backbone.on("networkLostEvent",this.networkLostHandler)},timerAction:function(){Backbone.on("dashboardUpdatedHandler",c.views.DashboardView.generateAcitvitiesCollection),c.settings.native?c.services.utilService.getNetworkConnection()&&c.services.phpService.getActivities(!1,null):c.services.phpService.getActivities(!1,null)},networkFoundHandler:function(){!c.settings.mapAdded&&c.services.utilService.getNetworkConnection()&&c.views.DashboardView.initMap(),c.services.phpService.getActivities(!1,null)},networkLostHandler:function(){},events:{"click #sortSelector a":"sortActivitiesChangeHandler","click #searchButton":"toggleSearchHandler","click #favs":"favsHandler","keyup #searchInput":"searchHandler","click #fullScreenButton":"fullscreenToggleHandler","click #menuButton":"menuOpenHandler","click #mapBtn":"fullscreenToggleHandler","click #downButton":"downButtonHandler"},downButtonHandler:function(){$("html, body").animate({scrollTop:$(document).height()},"slow")},fullscreenToggleHandler:function(){$("#dashboard",c.settings.currentPageHTML).toggleClass("mapOpen"),google.maps.event.trigger(c.views.DashboardView.map,"resize")},activitiesUpdateHandler:function(){c.collections.activities.each(function(a){a.setGoing()}),this.generateAcitvitiesCollection()},generateAcitvitiesCollection:function(){if(Backbone.off("dashboardUpdatedHandler"),c.views.DashboardView.filterEnabled)c.views.DashboardView.sortActivitiesChangeHandler();else if($("#activityTable",c.settings.currentPageHTML).empty(),0===c.collections.activities.length)$(".no-found",c.settings.currentPageHTML).removeAttr("style");else if(this.favouriteSportsFilter===!0&&0===$(c.collections.filteredActivitiesCollection.models).length)$(".no-found",c.settings.currentPageHTML).removeAttr("style");else{$(".no-found",c.settings.currentPageHTML).css({display:"none"}),c.views.activityListView=[],c.views.locationList=[];this.searching?$(c.collections.activitiesSearch).each(function(a,b){c.views.locationList.push(b),c.views.activityListView.push(new c.views.DashboardActivityView({model:b}))}):this.favouriteSportsFilter?$(c.collections.filteredActivitiesCollection.models).each(function(a,b){c.views.locationList.push(b),c.views.activityListView.push(new c.views.DashboardActivityView({model:b}))}):c.collections.activities.each(function(a){c.views.locationList.push(a),c.views.activityListView.push(new c.views.DashboardActivityView({model:a}))}),_(c.views.activityListView).each(function(a){$("#activityTable",c.settings.currentPageHTML).append(a.render().$el)}),c.services.utilService.getNetworkConnection()&&c.settings.native?c.views.DashboardView.setMarkers(c.views.locationList):c.settings.native||c.views.DashboardView.setMarkers(c.views.locationList)}},searchHandler:function(a){var b=$(a.target).val().toLowerCase();b.length>0?(c.collections.activitiesSearch=c.collections.activities.filter(function(a){return _.some([a.get("title")],function(a){return-1!=a.toLowerCase().indexOf(b)})}),this.searching=!0):this.searching=!1,this.generateAcitvitiesCollection()},toggleSearchHandler:function(){$("#searchBar").toggleClass("hide"),this.searching=$("#searchBar",c.settings.currentPageHTML).hasClass("hide")?!1:!0},sortActivitiesChangeHandler:function(a){c.views.DashboardView.filterEnabled=!1,a&&($("#sortSelector a",c.settings.currentPageHTML).removeClass("active"),$(a.target).addClass("active"));var b=$("#sortSelector .active",c.settings.currentPageHTML).index();switch(this.favouriteSportsFilter=!1,b){case 0:c.collections.activities.sort_by_attribute("sql_index");break;case 1:c.collections.activities.each(function(a){var b=c.models.userModel.get("current_location").split(","),d={};d.lat=b[0],d.lng=b[1];var e=a.attributes.coordinates.split(","),f={};f.lat=e[0],f.lng=e[1];var g=function(a){return a*Math.PI/180},h=6371,i=g(f.lat-d.lat),j=g(f.lng-d.lng),k=Math.sin(i/2)*Math.sin(i/2)+Math.cos(g(d.lat))*Math.cos(g(f.lat))*Math.sin(j/2)*Math.sin(j/2),l=2*Math.atan2(Math.sqrt(k),Math.sqrt(1-k)),m=h*l,n=m.toFixed(2);a.attributes.distance=parseInt(n)}),c.collections.activities.sort_by_attribute("distance");break;case 2:var d=[];c.models.userModel.attributes.myFavouriteSports.each(function(a){var b=new ActivitiesCollection;b=c.collections.activities.where({sport_id:a.attributes.sport_id})[0],d.push(b)});var e=(new ActivitiesCollection,new ActivitiesCollection);_.each(d,function(a){$(a).each(function(a,b){e.push(b)})}),c.collections.filteredActivitiesCollection=e,this.favouriteSportsFilter=!0}this.generateAcitvitiesCollection(),c.views.DashboardView.filterEnabled=!0},favsHandler:function(){},render:function(){return this.$el.html(this.template({sortForm:c.collections.sortOptions.toJSON()})),c.settings.currentPageHTML=this.$el,c.settings.native?c.services.utilService.getNetworkConnection()?this.initMap():$("#createActivityButton",c.settings.currentPageHTML).hide():c.settings.native||this.initMap(),this.generateAcitvitiesCollection(),this},menuOpenHandler:function(){$("#mainMenu").trigger("open")},initMap:function(){c.settings.mapAdded=!0;var a=c.models.userModel.attributes.current_location;a=""!==a||null!==a?c.models.userModel.attributes.current_location.split(","):c.settings.defaultLocation,c.views.DashboardView.locations=a;var b={backgroundColor:"#dacab4",zoom:15,center:new google.maps.LatLng(c.views.DashboardView.locations[0],c.views.DashboardView.locations[1]),mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,keyboardShortcuts:!1};c.views.DashboardView.map=new google.maps.Map($("#map_canvas",c.settings.currentPageHTML)[0],b),google.maps.event.addListenerOnce(c.views.DashboardView.map,"idle",function(){google.maps.event.trigger(c.views.DashboardView.map,"resize"),c.views.DashboardView.map.setCenter(new google.maps.LatLng(c.views.DashboardView.locations[0],c.views.DashboardView.locations[1]),13)});var d=new google.maps.MarkerImage(c.settings.iconPath+"my-map-icon@x2.png",null,null,null,new google.maps.Size(23,23)),e=new google.maps.Marker({position:new google.maps.LatLng(c.views.DashboardView.locations[0],c.views.DashboardView.locations[1]),icon:d,map:c.views.DashboardView.map,title:"",animation:google.maps.Animation.DROP,optimized:!1});c.views.DashboardView.markers.push(e);var f=google.maps.InfoWindow.prototype.set;google.maps.InfoWindow.prototype.set=function(a){return"map"!==a||this.get("noSupress")?void f.apply(this,arguments):void console.log('This InfoWindow is supressed. To enable it, set "noSupress" option to true')},navigator.geolocation&&c.settings.native&&(Backbone.on("getMyLocationHandler",this.getMyLocationHandler),c.services.utilService.getLocationService("dashboard"))},getMyLocationHandler:function(a){if(Backbone.off("getMyLocationHandler"),a){var b=a.coords.latitude+","+a.coords.longitude;c.models.userModel.attributes.current_location=b,c.views.DashboardView.locations=b.split(","),c.settings.native&&c.services.utilService.getNetworkConnection()?(c.views.DashboardView.map.setCenter(new google.maps.LatLng(a.coords.latitude,a.coords.longitude),13),c.views.DashboardView.setMarkers(c.views.locationList)):c.settings.native||(c.views.DashboardView.map.setCenter(new google.maps.LatLng(a.coords.latitude,a.coords.longitude),13),c.views.DashboardView.setMarkers(c.views.locationList))}},setMarkers:function(a){c.views.DashboardView.clearMarkers();var b=!1;$(a).each(function(a,d){d.attributes.users.length>0&&$(d.attributes.users).each(function(a,d){parseInt(d.user_id)===parseInt(c.models.userModel.attributes.user_id)&&(b=!0)});var e;if(e=b?new google.maps.MarkerImage(c.settings.iconPath+"goingMarker@x2.png",null,null,null,new google.maps.Size(26,30)):new google.maps.MarkerImage(c.settings.iconPath+"open-icon@x2.png",null,null,null,new google.maps.Size(26,30)),d.attributes.coordinates){var f=d.attributes.coordinates.split(","),g=new google.maps.Marker({position:new google.maps.LatLng(f[0],f[1]),map:c.views.DashboardView.map,title:"",icon:e,optimized:!1});g.activityModel=d,google.maps.event.addListener(g,"click",function(){window.location="#activity/"+this.activityModel.attributes.activity_id}),c.views.DashboardView.markers.push(g)}});var d=new google.maps.MarkerImage(c.settings.iconPath+"my-map-icon@x2.png",null,null,null,new google.maps.Size(23,23)),e=new google.maps.Marker({position:new google.maps.LatLng(c.views.DashboardView.locations[0],c.views.DashboardView.locations[1]),icon:d,map:c.views.DashboardView.map,title:"",optimized:!1});c.views.DashboardView.markers.push(e)},clearMarkers:function(){for(var a=0;a<c.views.DashboardView.markers.length;a++)c.views.DashboardView.markers[a].setVisible(!1);c.views.DashboardView.markers=[]}}),c.views.FavouriteSportListSettingView=Backbone.View.extend({initialize:function(){},render:function(){return this.model.attributes.path=c.settings.sportsPath,this.$el.html(this.template({data:this.model.toJSON(),icon:this.model.attributes.icon,path:c.settings.sportsPath})),this}}),c.views.FavouriteSportListView=Backbone.View.extend({initialize:function(){},render:function(){return this.model.attributes.path=c.settings.sportsPath,this.$el.html(this.template({data:this.model.toJSON(),icon:this.model.attributes.icon,path:c.settings.sportsPath})),this}}),c.views.FriendInvitieView=Backbone.View.extend({initialize:function(){c.views.FriendView.model=this.model,console.log(this.model.attributes.user_id)},render:function(){return this.$el.html(this.template({friend:this.model.toJSON(),imagePath:c.settings.imagePath})),c.settings.currentPageHTML=this.$el,this},events:{"click .inviteButton":"friendInviteHandler"},friendInviteHandler:function(a){if($(a.target).toggleClass("selected"),$(a.target).hasClass("selected")){$(a.target).text("Uitgenodigd");var b=c.models.userModel.attributes.myFriends.where({user_id:$(a.target,c.settings.currentPageHTML).attr("data-id")})[0];c.collections.selectedFriends.push(b)}else{$(a.target).text("Niet uitgenodigd");var d=c.collections.selectedFriends.where({user_id:$(a.target,c.settings.currentPageHTML).attr("data-id")})[0];c.collections.selectedFriends.remove(d)}console.log(c.collections.selectedFriends)}}),c.views.FriendView=Backbone.View.extend({initialize:function(){c.views.FriendView.model=this.model,this.model.attributes.myFriend=c.models.userModel.attributes.myFriends.where({user_id:this.model.attributes.user_id}).length>0?!1:c.views.FriendView.model.attributes.user_id==c.models.userModel.attributes.user_id?!1:!1,Backbone.on("networkFoundEvent",this.networkFoundHandler),Backbone.on("networkLostEvent",this.networkLostHandler)},networkFoundHandler:function(){},networkLostHandler:function(){},render:function(){this.$el.html(this.template({imagePath:c.settings.imagePath,user_id:c.models.userModel.attributes.user_id,user:this.model.toJSON()})),c.settings.currentPageHTML=this.$el,Backbone.on("userMediaHandler",this.userMediaRecievedHandler),c.services.phpService.getUserMedia(this.model.attributes.user_id),Backbone.on("getBadgesHandler",this.getBadgesHandler),c.services.phpService.getBadges(this.model.attributes.user_id);var a=c.services.avatarService.generateAvatar(c.views.FriendView.model),b=new c.views.AvatarDisplayView({model:a});return $("#avatar",c.settings.currentPageHTML).append(b.render().$el),this},getBadgesHandler:function(a){Backbone.off("getBadgesHandler"),c.views.FriendView.model.attributes.badges=new ChallengesCollection(a),0!==c.views.FriendView.model.attributes.badges.length?c.views.FriendView.model.attributes.badges.each(function(a){var b=new c.views.BadgeListView({model:a});$("#badgesView #badges",c.settings.currentPageHTML).empty().append(b.render().$el)}):$("#badgesView",c.settings.currentPageHTML).hide()},userMediaRecievedHandler:function(a){var b=[];0!==a.length?(a.each(function(a){a.attributes.userModel=c.views.FriendView.model.attributes,a.attributes.imagePath=c.settings.imagePath,b.push(new c.views.ActivityMediaViewer({model:a}))}),$("#mediaContainer",c.settings.currentPageHTML).empty(),_(b).each(function(a){$("#mediaContainer",c.settings.currentPageHTML).append(a.render().$el)})):$("#mediaSection",c.settings.currentPageHTML).hide()},events:{"click #backButton":"backHandler","click #addFriendButton":"addFriendHandler"},addFriendHandler:function(){Backbone.on("addedFriendHandler",this.addedAsFriendHandler),c.services.phpService.addFriend(c.views.FriendView.model.attributes.user_id,c.models.userModel.attributes.user_id)},backHandler:function(){window.history.back()},addedAsFriendHandler:function(){Backbone.off("addedFriendHandler"),$("#addFriendButton",c.settings.currentPageHTML).remove()}}),c.views.FriendsListView=Backbone.View.extend({initialize:function(){},render:function(){return this.$el.html(this.template({user:this.model.toJSON(),imagePath:c.settings.imagePath})),this}}),c.views.GoogleMapView=Backbone.View.extend({initialize:function(){},render:function(){this.$el.html(this.template()),c.settings.currentPageHTML=this.$el;var a={zoom:15,center:new google.maps.LatLng(14,10),mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0};c.settings.mapAdded=!0;new google.maps.Map($("#map",c.settings.currentPageHTML)[0],a);return this}}),c.views.HelperView=Backbone.View.extend({initialize:function(){},getLocation:function(){}}),c.views.HomeView=Backbone.View.extend({initialize:function(){c.events.userLoggedInEvent.bind("userLoggedInHandler",this.userLoggedInHandler),c.events.userLoggedInErrorEvent.bind("userLoggedInErrorHandler",this.userLoggedInErrorHandler),c.events.userLoggedInPasswordErrorEvent.bind("userLoggedInPasswordErrorHandler",this.userLoggedInPasswordErrorHandler),c.events.facebookLoginErrorEvent.bind("facebookLoginErrorHandler",this.facebookLoginErrorHandler),c.events.facebookGetFriendsEvent.bind("facebookGetFriendsHandler",this.facebookGetFriendsHandler),c.events.facebookGetFriendsErrorEvent.bind("userLoggedInPasswordErrorHandler",this.facebookGetFriendErrorHandler),c.events.getUserFromFacebookIDEvent.bind("facebookGetIDHandler",this.facebookGetIDHandler),c.events.facebookUserToSQLEvent.bind("facebookUserToSQLSuccesHandler",this.facebookUserToSQLSuccesHandler),c.events.locationHomeEvent.bind("locationSuccesHandler",this.locationSuccesHandler),c.events.locationHomeEvent.bind("locationErrorHandler",this.locationErrorHandler),Backbone.on("networkFoundEvent",this.networkFoundHandler),Backbone.on("networkLostEvent",this.networkLostHandler),c.views.HomeView.facebookLoginHandler=this.facebookLoginHandler,c.views.HomeView.facebookProfileDataHandler=this.facebookProfileDataHandler,c.views.HomeView.locationErrorHandler=this.locationErrorHandler,c.views.HomeView.nextSlide=this.nextSlide,c.views.HomeView.prevSlide=this.prevSlide,c.views.HomeView.gotoSlide=this.gotoSlide,c.views.HomeView.currentSlide=0,c.views.HomeView.slides=2},gotoSlide:function(a){a>c.views.HomeView.slides&&(a=0),0>a&&(a=c.views.HomeView.slides),$("#carouselNav li a",c.settings.currentPageHTML).removeClass("active"),$("#carouselNav li a:eq("+a+")").addClass("active"),$("#car"+c.views.HomeView.currentSlide).fadeOut(200,function(){$("#car"+a).fadeIn(200,function(){c.views.HomeView.currentSlide=a
}).css("display","table").addClass("active")})},prevSlide:function(){},nextSlide:function(){},networkFoundHandler:function(){},updateCSS:function(){var a=$(".cl-content ",c.settings.currentPageHTML).height()-$("#loginForm",c.settings.currentPageHTML).height()-60;$("#carouselContent li",c.settings.currentPageHTML).css({height:a+"px"})},networkLostHandler:function(){c.router.navigate("noconnection",!0)},render:function(){return this.$el.html(this.template()),c.settings.currentPageHTML=this.$el,this.setValidator(),this.$el.hammer(),$("#carousel",c.settings.currentPageHTML).delay(100).fadeOut(function(){var a=$(".cl-content ",c.settings.currentPageHTML).height()-$("#loginForm",c.settings.currentPageHTML).height()-60;$("#carouselContent li",c.settings.currentPageHTML).css({height:a+"px"}),$("#carousel",c.settings.currentPageHTML).fadeIn(200)}),$(window).on("resize",this.updateCSS),this},events:{"click #FBloginButton":"facebookClickHandler","click #loginFormSubmit":"loginFormSubmitHandler","click #carouselNav a":"carouselClickHandler","swipe #carouselContent":"onSwipe","click #carouselContent":"onClick"},onClick:function(){c.views.HomeView.gotoSlide(c.views.HomeView.currentSlide+1)},loginFormSubmitHandler:function(){$("#loginForm",c.settings.currentPageHTML).submit()},onSwipe:function(a){if("up"!==a.gesture.direction||"down"!==a.gesture.direction){var b=0;switch(a.gesture.direction){case"right":b=-1;break;case"left":b=1}var d=c.views.HomeView.currentSlide+b;c.views.HomeView.gotoSlide(d)}},carouselClickHandler:function(a){var b=$(a.target).parent().index();c.views.HomeView.gotoSlide(b),$("#carouselNav li a",c.settings.currentPageHTML).removeClass("active"),$(a.target).addClass("active")},setValidator:function(){$("#loginForm",c.settings.currentPageHTML).validate({submitHandler:function(){var a=$("#emailInput",c.settings.currentPageHTML).val(),b=$("#passwordInput",c.settings.currentPageHTML).val();c.models.userModel.set("email",a),c.models.userModel.set("password",b),c.services.phpService.userLogin()},invalidHandler:function(){}})},facebookUserToSQLSuccesHandler:function(){$("#facebookLoad").removeClass("hide"),c.router.navigate("loading",!0)},facebookGetIDHandler:function(a){a.facebook_user?(c.settings.newUser=!1,c.models.userModel.set("user_id",a.user_id),navigator.geolocation?(Backbone.on("locationError",c.views.HomeView.locationErrorHandler),c.services.utilService.getLocationService("login")):c.router.navigate("loading",!0)):(c.settings.newUser=!0,navigator.geolocation?(Backbone.on("locationError",c.views.HomeView.locationErrorHandler),c.services.utilService.getLocationService("login")):c.services.facebookService.facebookUserToSQL())},locationSuccesHandler:function(a){var b=a.coords.latitude+","+a.coords.longitude;c.models.userModel.set("current_location",b),c.settings.newUser?c.services.facebookService.facebookUserToSQL():c.router.navigate("loading",!0)},locationErrorHandler:function(){Backbone.off("locationError"),c.settings.newUser?c.services.facebookService.facebookUserToSQL():c.router.navigate("loading",!0)},facebookProfileDataHandler:function(){Backbone.off("facebookProfileDataHandler"),c.services.facebookService.getUserFromFacebookID()},facebookLoginHandler:function(){Backbone.off("facebookLoginHandler"),Backbone.on("facebookProfileDataHandler",c.views.HomeView.facebookProfileDataHandler),c.services.facebookService.getProfileData(),$("#facebookLoad").removeClass("hide")},facebookClickHandler:function(){Backbone.on("facebookLoginHandler",c.views.HomeView.facebookLoginHandler),c.settings.native||c.services.facebookService.facebookConnect(),c.services.facebookService.facebookLogin()},facebookLoginErrorHandler:function(){alert("error loggin on to facebook")},facebookGetFriendErrorHandler:function(){alert("error getting friends from facebook")},userLoggedInHandler:function(){navigator.geolocation?($("#facebookLoad").removeClass("hide"),Backbone.on("locationError",c.views.HomeView.locationErrorHandler),c.services.utilService.getLocationService("login")):($("#loginForm .error-box",c.currentPageHTML).removeClass("show").addClass("hide"),c.router.navigate("loading",!0))},userLoggedInPasswordErrorHandler:function(){$("#loginForm .error-box",c.currentPageHTML).html(c.messages.passwordIncorrect).removeClass("hide").addClass("show")},userLoggedInErrorHandler:function(){c.router.navigate("createUser",!0)}}),c.views.LoadingView=Backbone.View.extend({initialize:function(){c.views.LoadingView=this,c.events.getActivitiesSuccesEvent.bind("activitiesLoadedHandler",this.activitiesLoadedHandler),c.events.getSportsSuccesEvent.bind("sportsLoadedHandler",this.sportsLoadedHandlers),c.events.getUsersSuccesEvent.bind("usersLoadedHandler",this.usersLoadedHandler),c.events.getBuurtenEvent.bind("buurtenLoadedHandler",this.buurtenLoadedHandler),c.events.getLocationsSuccesEvent.bind("getLocationsSuccesHandler",this.getLocationsSuccesHandler),Backbone.on("getChallengesHandler",this.getChallengesHandler),Backbone.on("myPlannedActivitiesLoadedHandler",this.getMyPlannedActivitiesLoadedHandler),Backbone.on("myActivitiesLoadedHandler",this.getMyActivitiesLoadedHandler),Backbone.on("getFavouriteSportsHandler",this.getFavouriteSportsHandler),Backbone.on("getMyFavouriteSportsHandler",this.getMyFavouriteSportsHandler),Backbone.on("getMyChallengesHandler",this.getMyChallengesHandler),Backbone.on("getMyBadgesHandler",this.getMyBadgesHandler),Backbone.on("getFriendsHandler",this.loadingCompleteHandler),Backbone.on("networkFoundEvent",this.networkFoundHandler),Backbone.on("networkLostEvent",this.networkLostHandler),Backbone.on("getChallengesCount",this.getChallengesCount)},networkFoundHandler:function(){},networkLostHandler:function(){},render:function(){return this.$el.html(this.template(this.model.attributes)),c.settings.currentPageHTML=this.$el,c.settings.userLoggedIn?c.services.phpService.getChallengesCount():window.location.hash="",this},getChallengesCount:function(){c.services.phpService.getActivities(!0)},activitiesLoadedHandler:function(){c.services.phpService.getSports()},sportsLoadedHandlers:function(){c.services.phpService.getChallenges()},getChallengesHandler:function(){Backbone.off("getChallengesHandler"),c.services.phpService.getUsers()},usersLoadedHandler:function(){c.services.phpService.getBuurten()},buurtenLoadedHandler:function(){c.services.phpService.getLocations()},getLocationsSuccesHandler:function(){c.services.phpService.getMyPlannedActivities()},getMyPlannedActivitiesLoadedHandler:function(){Backbone.off("myPlannedActivitiesLoadedHandler"),c.services.phpService.getMyActivities()},getMyActivitiesLoadedHandler:function(){Backbone.off("myActivitiesLoadedHandler"),c.services.phpService.getFavouriteSports()},getFavouriteSportsHandler:function(){c.services.phpService.getUserFavouriteSports(),Backbone.off("getFavouriteSportsHandler")},getMyFavouriteSportsHandler:function(){c.services.phpService.getMyChallengesHandler(),Backbone.off("getMyFavouriteSportsHandler")},getMyChallengesHandler:function(){Backbone.off("getMyChallengesHandler"),c.services.phpService.getMyBadges()},getMyBadgesHandler:function(){Backbone.off("getMyBadgesHandler"),c.services.phpService.getFriends()},loadingCompleteHandler:function(){Backbone.off("getFriendsHandler"),window.localStorage.setItem("collections",JSON.stringify(c.collections)),window.localStorage.setItem("userModel",JSON.stringify(c.models.userModel)),c.settings.dataLoaded=!0,$("#mainMenu #userAvatar").removeAttr("style"),$("#mainMenu #userAvatar").css({background:"url("+c.settings.imagePath+c.models.userModel.attributes.avatar+") repeat center center","background-size":"cover"}),$("#mainMenu #userName").text(c.models.userModel.attributes.name),$("#mainMenu #userAvatar").css({"background-repeat":"no-repeat"}),c.models.userModel.attributes.myFavouriteSports.length>0?c.settings.forwardAfterLogin===!0?(c.settings.forwardAfterLogin=!1,window.location.hash="#activity/"+c.settings.forwardAfterLoginID):c.router.navigate("dashboard",!0):c.router.navigate("sportselector",!0)},destroy_view:function(){}}),c.views.NavigationBusView=Backbone.View.extend({initialize:function(){},render:function(){return this.$el.html(this.template(this.model.attributes)),c.settings.currentModuleHTML=this.$el,this}}),c.views.NavigationMapView=Backbone.View.extend({initialize:function(){},render:function(){return this.$el.html(this.template(this.model.attributes)),c.settings.currentModuleHTML=this.$el,this.setMap(),this},setMap:function(){c.settings.mapAdded=!0;var a={zoom:15,center:new google.maps.LatLng(14,10),mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0},b=this.$el,d=new google.maps.Map($("#map_canvas",b)[0],a),e=c.views.ActivityDetailView.model.attributes.coordinates.split(",");google.maps.event.addListenerOnce(d,"idle",function(){google.maps.event.trigger(d,"resize"),d.setCenter(new google.maps.LatLng(e[0],e[1]),13)});var f=new google.maps.DirectionsRenderer;f.setMap(d),f.setPanel($("#directions",b)[0]);var g=new google.maps.DirectionsService,h={origin:c.models.userModel.attributes.current_location,destination:c.views.ActivityDetailView.model.attributes.coordinates,travelMode:google.maps.DirectionsTravelMode.WALKING,unitSystem:google.maps.UnitSystem.METRIC};g.route(h,function(a,b){b==google.maps.DirectionsStatus.OK?(new google.maps.DirectionsRenderer({map:d,directions:a}),f.setDirections(a)):$("#error").append("Unable to retrieve your route<br />")})}}),c.views.NavigationView=Backbone.View.extend({initialize:function(){_.bindAll(this,"beforeRender","render","afterRender");var a=this;this.render=_.wrap(this.render,function(b){return a.beforeRender(),b(),a.afterRender(),a}),Backbone.on("networkFoundEvent",this.networkFoundHandler),Backbone.on("networkLostEvent",this.networkLostHandler)},networkFoundHandler:function(){},networkLostHandler:function(){},beforeRender:function(){},render:function(){return this.$el.html(this.template()),c.settings.currentPageHTML=this.$el,this.currentActivityPage="#googleMap",this},events:{"click #navigationTabs .cl-btn":"navigationTabsHandler","click .back-button":"back"},navigationTabsHandler:function(a){$("#navigationTabs .cl-btn").removeClass("active"),$(a.target,c.settings.currentPageHTML).addClass("active");var b=$(a.target,c.settings.currentPageHTML).attr("data");$(this.currentActivityPage,c.settings.currentPageHTML).removeClass("show").addClass("hide"),$(b,c.settings.currentPageHTML).removeClass("hide").addClass("show"),this.currentActivityPage=b},afterRender:function(){c.settings.mapAdded=!0;var a={zoom:15,center:new google.maps.LatLng(14,10),mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0},b=this.$el,d=new google.maps.Map($("#map_canvas",b)[0],a),e=c.views.ActivityDetailView.model.attributes.coordinates.split(",");google.maps.event.addListenerOnce(d,"idle",function(){google.maps.event.trigger(d,"resize"),d.setCenter(new google.maps.LatLng(e[0],e[1]),13)});var f=new google.maps.DirectionsRenderer;f.setMap(d),f.setPanel($("#directions",b)[0]);var g=new google.maps.DirectionsService,h={origin:c.models.userModel.attributes.current_location,destination:c.views.ActivityDetailView.model.attributes.coordinates,travelMode:google.maps.DirectionsTravelMode.WALKING,unitSystem:google.maps.UnitSystem.METRIC};g.route(h,function(a,b){b==google.maps.DirectionsStatus.OK?(new google.maps.DirectionsRenderer({map:d,directions:a}),f.setDirections(a)):$("#error").append("Unable to retrieve your route<br />")})},back:function(){return window.history.back(),!1}}),c.views.NoConnectionView=Backbone.View.extend({initialize:function(){Backbone.on("networkFoundEvent",this.networkFoundHandler),Backbone.on("networkLostEvent",this.networkLostHandler)},networkFoundHandler:function(){window.history.back()},networkLostHandler:function(){window.location="#"},render:function(){return this.$el.html(this.template()),c.settings.currentModuleHTML=this.$el,this},events:{"click #refreshButton":"checkConnectionHandler"},checkConnectionHandler:function(){c.services.utilService.checkConnection();alert(c.settings.network),c.settings.network&&(window.location="#")}}),c.views.PlannerInvitedActivitiesView=Backbone.View.extend({initialize:function(){c.views.PlannerInvitedActivitiesView.model=this.model},render:function(){return this.$el.html(this.template(this.model.attributes)),this}}),c.views.PlannerMyActivitiesView=Backbone.View.extend({tagName:"li",className:"plan",initialize:function(){},clickHandler:function(){},render:function(){var a=c.collections.sports.where({sport_id:this.model.attributes.sport_id})[0],b=this.model;return this.$el.html(this.template({data:this.model.attributes,imagePath:c.settings.sportsPath,sport:a.attributes.icon})),b.attributes.author_badge&&$(".edit-badge",this.$el).removeAttr("style"),this}}),c.views.PlannerTimelineWrap=Backbone.View.extend({initialize:function(){},render:function(){return this.$el.html(this.template()),this}}),c.views.PlannerView=Backbone.View.extend({initialize:function(){c.views.PlannerView.updatePlanner=this.updatePlanner,c.views.PlannerView.updatePlannerComplete=this.updatePlannerComplete,c.views.PlannerView.getInvitationsHandler=this.getInvitationsHandler,c.views.PlannerView.acceptedInvite=this.acceptInviteHandler,c.views.PlannerView.firstRet=!0,Backbone.on("acceptInviteHandler",this.acceptInviteHandler),c.views.PlannerView.acceptedInvite=this.acceptedInvite,Backbone.on("dashboardUpdatedHandler",this.generateTimeLine),c.settings.native?c.services.utilService.getNetworkConnection()&&c.services.phpService.getActivities(!1,null):c.services.phpService.getActivities(!1,null),Backbone.on("networkFoundEvent",this.networkFoundHandler),Backbone.on("networkLostEvent",this.networkLostHandler),c.settings.timer=setInterval(this.timerAction,4e6)},generateTimeLine:function(){c.views.activityListView=[],c.collections.activities.each(function(a){var b=!1;a.attributes.user_id==c.models.userModel.attributes.user_id?(b=!0,a.attributes.author_badge=!0):$(a.attributes.users).each(function(d,e){e.user_id==c.models.userModel.attributes.user_id&&(a.attributes.author_badge=!1,b=!0)}),b&&c.views.activityListView.push(new c.views.PlannerMyActivitiesView({model:a}))}),$("#plannerMap",c.settings.currentPageHTML).empty();var a;_(c.views.activityListView).each(function(b){if(a==b.model.attributes.savedDate)$("#plannerMap .planner-section .plan-list",c.settings.currentPageHTML).last().append(b.render().$el);else{var d="",e=b.model.attributes.date.split(" ");switch(e[0]){case"Vandaag":d=e[0];break;case"Morgen":d=e[0]}""===d&&(d=b.model.attributes.date),fr=new c.views.PlannerTimelineWrap,$("#plannerMap",c.settings.currentPageHTML).append(fr.render().$el),$("#plannerMap h3",c.settings.currentPageHTML).last().text(d),$("#plannerMap .planner-section .plan-list",c.settings.currentPageHTML).last().append(b.render().$el).hide(),c.views.PlannerView.firstRet?(c.views.PlannerView.firstRet=!1,$(".plan-list",c.settings.currentPageHTML).show(600)):$(".plan-list",c.settings.currentPageHTML).show()}a=b.model.attributes.savedDate}),$(".plan-list li",c.settings.currentPageHTML).click(function(a){var b=$("h2",a.currentTarget).attr("data-id");b&&(window.location.href=$(a.target).hasClass("edit-badge")?"#update/"+b:"#activity/"+b)}),c.services.utilService.updateLocalStorage()},timerAction:function(){Backbone.on("dashboardUpdatedHandler",this.generateTimeLine),c.settings.native?c.services.utilService.getNetworkConnection()&&c.services.phpService.getActivities(!1,null):c.services.phpService.getActivities(!1,null)},networkFoundHandler:function(){Backbone.on("myPlannedActivitiesLoadedHandler",this.updatePlanner),c.services.phpService.getMyPlannedActivities()},networkLostHandler:function(){},events:{"click .inviteButtons a":"handleInviteHandler","click #menuButton":"menuOpenHandler"},menuOpenHandler:function(){$("#mainMenu").trigger("open")},handleInviteHandler:function(a){var b=$(a.target).attr("data"),d=$(a.target).parent().attr("data-invitation"),e=$(a.target).parent().attr("data-activity-id");$(a.target).parent().parent().hide(200),Backbone.on("acceptInviteHandler"),c.services.phpService.handleInvitations(d,b,e)},acceptInviteHandler:function(){console.log("invite updated"),Backbone.on("myPlannedActivitiesLoadedHandler",c.views.PlannerView.updatePlanner),c.services.phpService.getMyPlannedActivities()},updatePlanner:function(){console.log("myPlannedActivitiesLoadedHandler"),Backbone.on("myActivitiesLoadedHandler",c.views.PlannerView.updatePlannerComplete),c.services.phpService.getMyActivities()},updatePlannerComplete:function(){console.log("myActivitiesLoadedHandler"),Backbone.on("getInvitationsHandler",c.views.PlannerView.getInvitationsHandler),c.services.phpService.getMyInvitations()},getInvitationsHandler:function(){Backbone.off("myPlannedActivitiesLoadedHandler"),Backbone.off("myActivitiesLoadedHandler"),Backbone.off("getInvitationsHandler"),Backbone.off("acceptInviteHandler"),c.views.PlannerView.myActivitiesView=[],c.views.PlannerView.myJoinedActivitiesView=[],c.views.PlannerView.myInvitedActivitiesView=[],c.services.utilService.updateLocalStorage()},render:function(){return this.$el.html(this.template()),c.settings.currentPageHTML=this.$el,this}}),c.views.ProfileAvatarView=Backbone.View.extend({className:"avatar-page",initialize:function(){},render:function(){this.$el.html(this.template(c.models.userModel.toJSON())),c.settings.currentModuleHTML=this.$el;var a=c.services.avatarService.generateAvatar(c.models.userModel),b=new c.views.AvatarDisplayView({model:a});return $("#avatar",c.settings.currentModuleHTML).append(b.render().$el),$("#strength_progress",c.settings.currentModuleHTML).progressbar({value:parseInt(c.models.userModel.attributes.strength_score)}),$("#stamina_progress",c.settings.currentModuleHTML).progressbar({value:parseInt(c.models.userModel.attributes.stamina_score)}),this}}),c.views.ProfileChallengeView=Backbone.View.extend({initialize:function(){c.views.ProfileChallengeView.updateChallenges=this.updateChallenges,c.views.ProfileChallengeView.getChallengesCompleteHandler=this.getChallengesCompleteHandler,c.views.ProfileChallengeView.getMyChallengesCompleteHandler=this.getMyChallengesCompleteHandler,c.views.ProfileChallengeView.getMyBadgesCompleteHandler=this.getMyBadgesCompleteHandler,Backbone.on("joinedChallengeHandler",this.joinedChallengeSuccesHandler),Backbone.on("getChallengesHandler",c.views.ProfileChallengeView.getChallengesCompleteHandler),c.settings.native?c.services.utilService.getNetworkConnection()?c.services.phpService.getChallenges():this.updateChallenges():c.services.phpService.getChallenges(),Backbone.on("networkFoundEvent",this.networkFoundHandler),Backbone.on("networkLostEvent",this.networkLostHandler)},networkFoundHandler:function(){c.services.phpService.getChallenges()},networkLostHandler:function(){},render:function(){return this.$el.html(this.template()),c.settings.currentModuleHTML=this.$el,$(window).resize(_.debounce(function(){c.views.ProfileChallengeView.updateChallenges()},500)),$("#badgesOverview",c.settings.currentModuleHTML).hide(),this},joinedChallengeSuccesHandler:function(){Backbone.on("getChallengesHandler",c.views.ProfileChallengeView.getChallengesCompleteHandler),c.services.phpService.getChallenges()},getChallengesCompleteHandler:function(){Backbone.off("getChallengesHandler"),Backbone.on("getMyChallengesHandler",c.views.ProfileChallengeView.getMyChallengesCompleteHandler),c.services.phpService.getMyChallengesHandler()},getMyChallengesCompleteHandler:function(){Backbone.off("getMyChallengesHandler"),Backbone.on("getMyBadgesHandler",c.views.ProfileChallengeView.getMyBadgesCompleteHandler),c.services.phpService.getMyBadges()},getMyBadgesCompleteHandler:function(){Backbone.off("getMyBadgesHandler"),c.views.ProfileChallengeView.updateChallenges()},updateChallenges:function(){var a=($("#badgesOverview ul",c.settings.currentModuleHTML).width(),$("#badgesOverview ul li",c.settings.currentModuleHTML).first().width()+12+2);a=parseInt(a);var b=c.models.userModel.attributes.challengesCount;if(!isNaN(b)){$("#badgesOverview ul",c.settings.currentModuleHTML).empty();for(var d=0;b>d;d++)$("#badgesOverview ul",c.settings.currentModuleHTML).append("<li></li>")}$("#badgesOverview",c.settings.currentModuleHTML).slideDown(200),c.views.challengeListView=[],c.collections.challenges.each(function(a){c.views.challengeListView.push(new c.views.ChallengeListView({model:a}))}),c.views.myChallengesListView=[],c.models.userModel.attributes.myChallenges.each(function(a){c.views.myChallengesListView.push(new c.views.ActiveChallengeListView({model:a}))}),c.views.myBadgesListView=[],c.models.userModel.attributes.myBadges.each(function(a){c.views.myBadgesListView.push(new c.views.BadgeListView({model:a}))}),$("#challengesOverviewTable",c.settings.currentModuleHTML).empty(),c.views.challengeListView.length>0&&($("#challengesOverview",c.settings.currentModuleHTML).removeClass("hide"),_(c.views.challengeListView).each(function(a){$("#challengesOverviewTable",c.settings.currentModuleHTML).append(a.render().$el)}));var e,f=0;if($("#challengesOverview .challenge-item",c.settings.currentModuleHTML).each(function(){$this=$(this),$this.outerHeight()>f&&(e=this,f=$this.outerHeight())}),$("#challengesOverview .challenge-item",c.settings.currentModuleHTML).css({"min-height":f+"px"}),$("#myChallengesOverviewTable",c.settings.currentModuleHTML).empty(),c.views.myChallengesListView.length>0&&($("#myChallengesOverview",c.settings.currentModuleHTML).removeClass("hide"),_(c.views.myChallengesListView).each(function(a){$("#myChallengesOverviewTable",c.settings.currentModuleHTML).append(a.render().$el)})),f=0,$("#myChallengesOverview .challenge-item",c.settings.currentModuleHTML).each(function(){$this=$(this),$this.outerHeight()>f&&(e=this,f=$this.outerHeight())}),$("#myChallengesOverview .challenge-item",c.settings.currentModuleHTML).css({"min-height":f+"px"}),c.views.myBadgesListView.length>0){var g=0;_(c.views.myBadgesListView).each(function(a){$("#badgesOverview ul li:eq("+g+")",c.settings.currentModuleHTML).append(a.render().$el).addClass("badger"),g++})}0===c.views.challengeListView.length?$(".no-found",c.settings.currentModuleHTML).removeClass("hide"):$(".no-found",c.settings.currentModuleHTML).addClass("hide"),0===c.views.myChallengesListView.length?$(".no-found2",c.settings.currentModuleHTML).removeClass("hide"):$(".no-found2",c.settings.currentModuleHTML).addClass("hide"),c.services.utilService.updateLocalStorage()}}),c.views.ProfileFriendsView=Backbone.View.extend({className:"friendbox",initialize:function(){c.views.friendsListView=[],c.views.ProfileFriendsView.friendRemovedHandler=this.friendRemovedHandler,c.views.ProfileFriendsView.generateFriendsList=this.generateFriendsList,c.services.phpService.getFriends(),Backbone.on("getFriendsHandler",this.getMyFriendsHandler)},getMyFriendsHandler:function(){console.log("updated friends"),Backbone.off("getFriendsHandler"),c.views.ProfileFriendsView.generateFriendsList()},events:{"click .removeFriend":"removeFriendHandler"},friendRemovedHandler:function(){console.log("friend remove")},removeFriendHandler:function(a){var b=$(a.target).parent().attr("friend-id");Backbone.on("friendRemovedHandler",c.views.ProfileFriendsView.friendRemovedHandler),c.services.phpService.removeFriend(b),$(a.target).parent().hide(200)},generateFriendsList:function(){c.views.friendsListView=[],$(c.models.userModel.attributes.myFriends.models).each(function(a,b){c.views.friendsListView.push(new c.views.FriendsListView({model:b}))}),$("#profileFriendsListView",c.settings.currentModuleHTML).empty(),_(c.views.friendsListView).each(function(a){$("#profileFriendsListView",c.settings.currentModuleHTML).hide().append(a.render().$el)}),$("#profileFriendsListView",c.settings.currentModuleHTML).show(200,function(){var a=$(".friend-box span",c.settings.currentModuleHTML).first().width();$(".friend-box span",c.settings.currentModuleHTML).css({height:a+"px"})})},render:function(){return this.$el.html(this.template()),c.settings.currentModuleHTML=this.$el,this.generateFriendsList(),$(window).resize(_.debounce(function(){var a=$(".friend-box span",c.settings.currentModuleHTML).first().width();$(".friend-box span",c.settings.currentModuleHTML).css({height:a+"px"})},500)),this}}),c.views.ProfileView=Backbone.View.extend({initialize:function(){Backbone.on("networkFoundEvent",this.networkFoundHandler),Backbone.on("networkLostEvent",this.networkLostHandler)},deviceOfflineHandler:function(){},deviceOnlineHandler:function(){},render:function(){this.$el.html(this.template()),c.settings.currentPageHTML=this.$el;var a=new c.views.ProfileAvatarView;return $("#profileContent",c.settings.currentPageHTML).empty().append(a.render().$el),0===c.models.userModel.attributes.myFriends.models.length&&$("#friendsButton",c.settings.currentPageHTML).remove(),this},events:{"click #profileTabs .cl-btn":"profileTabHandler","click #menuButton":"menuOpenHandler"},menuOpenHandler:function(){$("#mainMenu").trigger("open")},profileTabHandler:function(a){var b=(this.$el,"#atleetContent");$("#profileTabs .cl-btn",c.settings.currentPageHTML).removeClass("active"),$(a.target,c.settings.currentPageHTML).addClass("active"),b=e;var d,e=$(a.target,c.settings.currentPageHTML).attr("data");switch(e){case"#atleetContent":d=new c.views.ProfileAvatarView;break;case"#uitdagingenContent":d=new c.views.ProfileChallengeView;break;case"#vriendenContent":d=new c.views.ProfileFriendsView}$("#profileContent",c.settings.currentPageHTML).empty(),$("#profileContent",c.settings.currentPageHTML).empty().append(d.render().$el),this.currentActivityPage=e}}),c.views.SettingsView=Backbone.View.extend({initialize:function(){c.views.SettingsView.avatarUploadHandler=this.avatarUploadHandler,c.views.SettingsView.avatarUpdatedHandler=this.avatarUpdatedHandler,c.views.SettingsView.fileUploadedHandler=this.fileUploadedHandler,c.views.SettingsView.generateFavouriteSportList=this.generateFavouriteSportList,c.views.SettingsView.align=this.align,Backbone.on("networkFoundEvent",this.networkFoundHandler),Backbone.on("networkLostEvent",this.networkLostHandler)},networkFoundHandler:function(){},networkLostHandler:function(){},render:function(){return this.$el.html(this.template({imagePath:c.settings.imagePath,user:c.models.userModel.attributes})),c.settings.currentPageHTML=this.$el,c.settings.native||$("#changeAvatar",c.settings.currentPageHTML).click(function(){return $("#nonNativeFileField",c.settings.currentPageHTML).trigger("click"),!1}),(0==c.settings.native||c.settings.native&&c.services.utilService.getNetworkConnection())&&(Backbone.on("getMyFavouriteSportsHandler",this.getFavouriteSportsHandler),c.services.phpService.getUserFavouriteSports()),this},getFavouriteSportsHandler:function(){Backbone.off("getMyFavouriteSportsHandler"),c.views.SettingsView.generateFavouriteSportList()},generateFavouriteSportList:function(){$("#favouriteSportList .rm",c.settings.currentPageHTML).remove(),_(c.models.userModel.attributes.myFavouriteSports.models).each(function(a){var b=new c.views.FavouriteSportListSettingView({model:a});$("#favouriteSportList",c.settings.currentPageHTML).prepend(b.render().$el)}),$("#favouriteSportList",c.settings.currentPageHTML).hide(),$("#favouriteSportList",c.settings.currentPageHTML).delay(1e3).queue(function(){c.views.SettingsView.align()}),$(window).resize(_.debounce(function(){c.views.SettingsView.align()},500))},mediaFormSubmitHandler:function(a){a.stopPropagation(),a.preventDefault();var b=new FormData;$.each(c.views.SettingsView.files,function(a,c){b.append(a,c)}),Backbone.on("fileUploadedEvent",c.views.SettingsView.fileUploadedHandler),c.services.phpService.uploadMediaNonNative(b)},fileUploadedHandler:function(a){Backbone.off("fileUploadedEvent");var b=a.files[0].replace(/^.*[\\\/]/,"");c.views.SettingsView.uploadedPhotoUrl=b,Backbone.on("updateUserAvatar",c.views.SettingsView.avatarUpdatedHandler),c.services.phpService.updateUserAvatar(b)},nonNativeFileSelectedHandler:function(a){var b=a.target.files;c.views.SettingsView.files=b,$("#mediaForm",c.settings.currentPageHTML).submit()},events:{"click #changeAvatar":"changeAvatarHandler","click #signOutButton":"signOutHandler","change #nonNativeFileField":"nonNativeFileSelectedHandler","submit #mediaForm":"mediaFormSubmitHandler","click #sportselector":"sportselectorClickHandler","click .rm":"sportselectorClickHandler","click #confirm":"sportselectorClickHandler"},sportselectorClickHandler:function(){c.settings.sportselector=!0,window.location.hash="sportselector"},align:function(){$("#favouriteSportList").hide();var a=$(".cl-content").width(),b=74,c=parseInt(a)/parseInt(b),d=Math.floor(c),e=d*b,f=a-e,g=f/2;$("#favouriteSportList").css({"margin-left":g+"px","margin-right":g+"px",width:e+"px",display:"block"}),$("#favouriteSportList").show(500)},signOutHandler:function(){window.localStorage.clear(),c.settings.userLoggedIn=!1,c.settings.storageFound=!1,c.settings.dataLoaded=!1,location.reload()},avatarUpdatedHandler:function(){Backbone.off("updateUserAvatar"),$("#userAvatar",c.settings.currentPageHTML).delay(400).attr("style","background: url('"+c.settings.imagePath+c.views.SettingsView.uploadedPhotoUrl+"') no-repeat; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover; background-size: cover;"),c.models.userModel.attributes.avatar=c.views.SettingsView.uploadedPhotoUrl,c.settings.native&&c.services.utilService.updateLocalStorage(),$("#mainMenu #userAvatar").css({background:"url("+c.settings.imagePath+c.models.userModel.attributes.avatar+") no-repeat","-webkit-background-size":"cover","-moz-background-size":"cover","-o-background-size":"cover","background-size":"cover"})},changeAvatarHandler:function(){navigator.camera.getPicture(this.uploadAvatar,function(){},{quality:50,targetWidth:640,targetHeight:480,destinationType:navigator.camera.DestinationType.FILE_URI,sourceType:navigator.camera.PictureSourceType.CAMERA})},avatarUploadHandler:function(){Backbone.on("updateUserAvatar",c.views.SettingsView.avatarUpdatedHandler),c.services.phpService.updateUserAvatar(c.views.SettingsView.uploadedPhotoUrl)},uploadAvatar:function(a){function b(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;5>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}var d=new FileUploadOptions;d.fileKey="file",d.fileName=b()+".jpg",d.mimeType="image/jpeg";var e=new Object;e.value1=d.fileName,c.views.SettingsView.uploadedPhotoUrl=d.fileName,d.params=e,d.chunkedMode=!1;var f=new FileTransfer;f.upload(a,c.settings.servicePath+c.settings.imageUploadService,c.views.SettingsView.avatarUploadHandler,null,d)}}),c.views.SportSelectorView=Backbone.View.extend({initialize:function(){c.views.SportSelectorView.selectedSports=[],Backbone.on("addFavouriteSportsHandler",this.addFavouriteSportsHandler),c.views.SportSelectorView.model=this.model,c.views.SportSelectorView.align=this.align,Backbone.on("networkFoundEvent",this.networkFoundHandler),Backbone.on("networkLostEvent",this.networkLostHandler)},networkFoundHandler:function(){},networkLostHandler:function(){},render:function(){this.$el.html(this.template({user:c.models.userModel.toJSON()})),c.settings.currentPageHTML=this.$el,c.views.SportSelectorView.favouriteSportsViewList=[],c.collections.sports.each(function(a){c.views.SportSelectorView.favouriteSportsViewList.push(new c.views.FavouriteSportListView({model:a}))});this.generateGrid();return c.views.CreateActivityLocationView.locationAutComplete=new AutoCompleteView({input:$("#sportInput",c.settings.currentPageHTML),model:c.collections.sports,wait:100,updateModel:this.model,updateID:"sport_id",onSelect:function(a){a.attributes.object_class="selected",c.views.SportSelectorView.favouriteSportsViewList.push(new c.views.FavouriteSportListView({model:a})),$("#favouriteSportList",c.settings.currentPageHTML).empty(),_(c.views.SportSelectorView.favouriteSportsViewList).each(function(a){$("#favouriteSportList",c.settings.currentPageHTML).append(a.render().$el)
})}}).render(),$("#favouriteSportList",c.settings.currentPageHTML).hide(),$("#favouriteSportList",c.settings.currentPageHTML).delay(1e3).queue(function(){c.views.SportSelectorView.align()}),$(window).resize(_.debounce(function(){c.views.SportSelectorView.align()},500)),this},align:function(){$("#favouriteSportList").hide();var a=$(".cl-content").width(),b=74,c=parseInt(a)/parseInt(b),d=Math.floor(c),e=d*b,f=a-e,g=f/2;$("#favouriteSportList").css({"margin-left":g+"px","margin-right":g+"px",width:e+"px",display:"block"}),$("#favouriteSportList").show(500)},generateGrid:function(){$("#favouriteSportList",c.settings.currentPageHTML).empty(),_(c.views.SportSelectorView.favouriteSportsViewList).each(function(a,b){$("#favouriteSportList",c.settings.currentPageHTML).append(a.render().$el),b==c.views.SportSelectorView.favouriteSportsViewList.length-1}),c.models.userModel.attributes.myFavouriteSports.models.length>0&&$("#backButton",c.settings.currentPageHTML).removeClass("hide"),$.each(c.models.userModel.attributes.myFavouriteSports.models,function(a,b){$("#sp"+b.attributes.sport_id,c.settings.currentPageHTML).addClass("selected")})},events:{"click #confirm":"confirmSportsHandler","click #favouriteSportList a":"favouriteSportClickHandler"},favouriteSportClickHandler:function(a){$(a.target).toggleClass("selected")},confirmSportsHandler:function(){var a=[];$("#favouriteSportList .selected .layer",c.settings.currentPageHTML).each(function(b,d){var e=$(d).attr("data-id"),f=c.collections.sports.where({sport_id:e.toString()});a.push(f[0])}),c.services.phpService.addFavouriteSportsService(a)},addFavouriteSportsHandler:function(){c.services.utilService.updateLocalStorage(),c.settings.forwardAfterLogin?(c.settings.forwardAfterLogin=!1,window.location.hash="#activity/"+c.settings.forwardAfterLoginID):c.settings.sportselector?(c.settings.sportselector=!1,c.router.navigate("settings",!0)):c.router.navigate("dashboard",!0)}}),c.routers.AppRouter=Backbone.Router.extend({routes:{"":"home",dashboard:"dashboard",planner:"planner",profile:"profile","activity/:id":"activity",navigater:"navigater",createActivity:"createActivity",createUser:"createUser",settings:"settings",sportselector:"sportselector",noconnection:"noconnection",loading:"loading","friend/:id":"friend","update/:id":"update","forward/:id":"forward"},initialize:function(){c.slider=new PageSlider($("#container")),this.routesHit=0,Backbone.history.on("route",function(){this.routesHit++},this)},back:function(){this.routesHit>1?window.history.back():this.navigate("/",{trigger:!0,replace:!0})},forward:function(a){c.settings.forwardAfterLoginID=a,c.settings.forwardAfterLogin=!0,window.location.hash="#"},noconnection:function(){c.slider.slidePage((new c.views.NoConnectionView).render().$el)},home:function(){c.settings.native?c.settings.network?c.settings.userLoggedIn?window.location.hash="loading":c.slider.slidePage((new c.views.HomeView).render().$el):c.settings.storageFound?(c.services.utilService.localDataToCollection(c.storage),window.location.hash="dashboard"):window.location.hash="noconnection":c.slider.slidePage((new c.views.HomeView).render().$el)},loading:function(){c.settings.dataLoaded?window.location.hash="dashboard":c.slider.slidePage(new c.views.LoadingView({model:c.models.userModel}).render().$el)},dashboard:function(){c.settings.created=!1,clearInterval(c.settings.timer),$("#mainMenu ul li").removeClass("mm-selected"),$("#mainMenu ul li").first().addClass("mm-selected"),c.settings.userLoggedIn?c.settings.dataLoaded?c.slider.slidePage((new c.views.DashboardView).render().$el):window.location.hash="loading":window.location.hash=""},planner:function(){clearInterval(c.settings.timer),$("#plannerButton").addClass("mm-selected"),c.settings.userLoggedIn?c.slider.slidePage((new c.views.PlannerView).render().$el):window.location.hash=""},profile:function(){$("#mainMenu ul li").removeClass("mm-selected"),$("#mainMenu #profielButton").addClass("mm-selected"),c.settings.userLoggedIn?c.slider.slidePage((new c.views.ProfileView).render().$el):window.location.hash=""},friend:function(a){if(c.settings.userLoggedIn){var b=c.collections.users.where({user_id:a});b=b[0],c.slider.slidePage(new c.views.FriendView({model:b}).render().$el)}else window.location.hash=""},activity:function(){c.settings.userLoggedIn?c.slider.slidePage((new c.views.ActivityDetailView).render().$el):window.location.hash=""},update:function(a){if(c.settings.userLoggedIn)if(c.settings.dataLoaded){var b=c.collections.activities,d=b.where({activity_id:a});d=d[0],d.attributes.updateActivity=!0,c.slider.slidePage(new c.views.CreateActivityView({model:d}).render().$el)}else window.location.hash="loading";else window.location.hash=""},createActivity:function(){c.settings.userLoggedIn?c.settings.created?window.location.hash="#dashboard":c.settings.dataLoaded?c.slider.slidePage(new c.views.CreateActivityView({model:c.models.userTemplate}).render().$el):window.location.hash="loading":window.location.hash=""},createUser:function(){c.slider.slidePage(new c.views.CreateUserView({model:c.models.userModel}).render().$el)},navigater:function(){c.settings.userLoggedIn?c.slider.slidePage((new c.views.NavigationView).render().$el):window.location.hash=""},activity:function(a){if(c.settings.userLoggedIn)if(c.settings.dataLoaded){var b=c.collections.activities,d=b.where({activity_id:a});d=d[0];var e=new c.views.ActivityDetailView({model:d});c.slider.slidePage(e.render().$el)}else window.location.hash="loading";else window.location.hash=""},settings:function(){c.settings.userLoggedIn?c.slider.slidePage((new c.views.SettingsView).render().$el):window.location.hash=""},sportselector:function(){c.settings.userLoggedIn?c.slider.slidePage(new c.views.SportSelectorView({model:new Backbone.Model({sport_id:""})}).render().$el):window.location.hash=""},checkLoggedIn:function(){}}),c.services.AvatarService=Backbone.Model.extend({initialize:function(){},addScore:function(a){var b,d=[];switch(a){case"create":b=1.1;break;case"join":b=.5;break;case"media":b=1.1;break;case"chat":b=1.1;break;case"challenge":b=1.2;break;case"friend":b=1.1}for(;d.length<3;){for(var e=Math.ceil(3*Math.random()*b),f=!1,g=0;g<d.length;g++)if(d[g]==e){f=!0;break}f||(d[d.length]=e)}c.models.userModel.attributes.equipment_score=parseInt(c.models.userModel.attributes.equipment_score)+d[0],c.models.userModel.attributes.stamina_score=parseInt(c.models.userModel.attributes.stamina_score)+d[1],c.models.userModel.attributes.strength_score=parseInt(c.models.userModel.attributes.strength_score)+d[2],Backbone.on("updateAvatarCompleteHandler",this.avatarCompleteHandler),c.services.phpService.updateAvatar()},avatarCompleteHandler:function(){Backbone.off("updateAvatarCompleteHandler")},levelUp:function(){Backbone.trigger("levelUp")},generateAvatar:function(a){var b=new Avatar;switch(b.attributes.strengthDisplay="",b.attributes.equipmentDisplay="",parseInt(a.attributes.gender)){case 0:console.log("female avatar");var c=parseInt(a.attributes.strength_score);20>c?b.attributes.strengthDisplay=b.attributes.female.strength[0]:40>c?b.attributes.strengthDisplay=b.attributes.female.strength[1]:60>c?b.attributes.strengthDisplay=b.attributes.female.strength[2]:80>c?b.attributes.strengthDisplay=b.attributes.female.strength[3]:100>c?b.attributes.strengthDisplay=b.attributes.female.strength[4]:c>99&&(b.attributes.strengthDisplay=b.attributes.female.strength[5]);var d=parseInt(a.attributes.equipment_score);20>d?b.attributes.equipmentDisplay=b.attributes.female.equipment[0]:40>d?b.attributes.equipmentDisplay=b.attributes.female.equipment[1]:60>d?b.attributes.equipmentDisplay=b.attributes.female.equipment[2]:80>d?b.attributes.equipmentDisplay=b.attributes.female.equipment[3]:100>d?b.attributes.equipmentDisplay=b.attributes.female.equipment[4]:d>99&&(b.attributes.equipmentDisplay=b.attributes.female.equipment[5]);break;case 1:console.log("male avatar");var c=parseInt(a.attributes.strength_score);20>c?b.attributes.strengthDisplay=b.attributes.male.strength[0]:40>c?b.attributes.strengthDisplay=b.attributes.male.strength[1]:60>c?b.attributes.strengthDisplay=b.attributes.male.strength[2]:80>c?b.attributes.strengthDisplay=b.attributes.male.strength[3]:100>c?b.attributes.strengthDisplay=b.attributes.male.strength[4]:c>99&&(b.attributes.strengthDisplay=b.attributes.male.strength[5]);var d=parseInt(a.attributes.equipment_score);20>d?b.attributes.equipmentDisplay=b.attributes.male.equipment[0]:40>d?b.attributes.equipmentDisplay=b.attributes.male.equipment[1]:60>d?b.attributes.equipmentDisplay=b.attributes.male.equipment[2]:80>d?b.attributes.equipmentDisplay=b.attributes.male.equipment[3]:100>d?b.attributes.equipmentDisplay=b.attributes.male.equipment[4]:d>99&&(b.attributes.equipmentDisplay=b.attributes.male.equipment[5])}return b}}),c.services.CHallengeService=Backbone.Model.extend({initialize:function(){},checkChallenges:function(a,b,d,e,f,g){a.attributes.myChallenges.each(function(a){var h,i=a.attributes.status,j=!1,k=!1,l=!1,m=!1,n=!1;if(a.attributes.challengeData.sportsFilter&&b){h=a.attributes.challengeData.sportsFilter.total;var o=a.attributes.challengeData.sportsFilter.sport_id;n=!0,g.attributes.sport_id==o&&("undefined"==typeof i.sportsFilter?(i.sportsFilter={},i.sportsFilter.count=0,i.sportsFilter.count++):i.sportsFilter.count++,i.sportsFilter.count>=h&&(i.sportsFilter.complete=!0,j=!0))}else j=!0;a.attributes.challengeData.activityCreateFilter&&d?(h=a.attributes.challengeData.activityCreateFilter.total,n=!0,"undefined"==typeof i.activityCreateFilter?(i.activityCreateFilter={},i.activityCreateFilter.count=0,i.activityCreateFilter.count++):i.activityCreateFilter.count++,i.activityCreateFilter.count>=h&&(i.activityCreateFilter.complete=!0,k=!0)):k=!0,a.attributes.challengeData.fotoCreateFilter&&e?(h=a.attributes.challengeData.fotoCreateFilter.total,n=!0,"undefined"==typeof i.fotoCreateFilter?(i.fotoCreateFilter={},i.fotoCreateFilter.count=0,i.fotoCreateFilter.count++):i.fotoCreateFilter.count++,console.log(i.fotoCreateFilter.count+"-"+h),i.fotoCreateFilter.count>=h&&(i.fotoCreateFilter.complete=!0,l=!0)):l=!0,a.attributes.challengeData.participateFilter&&f?(h=a.attributes.challengeData.participateFilter.total,n=!0,"undefined"==typeof i.participateFilter?(i.participateFilter={},i.participateFilter.count=0,i.participateFilter.count++):i.participateFilter.count++,i.participateFilter.count>=h&&(i.participateFilter.complete=!0,m=!0)):m=!0;var p=0;j&&k&&l&&m&&n&&(p=1,console.log("challenge complete")),console.log("check hieronder"),console.log(a),Backbone.on("updateChallengeScore",this.updateChallengeScore),c.services.phpService.updateChallenge(a.attributes.challenge_id,i,p)})},updateChallengeScore:function(){alert("updated")}}),c.services.FacebookServices=Backbone.Model.extend({initialize:function(){},facebookConnect:function(){if(!c.settings.native)try{FB.init({appId:"595730207182331",status:!1})}catch(a){alert(a)}},facebookUserToSQL:function(){$.ajax({url:c.settings.servicePath+c.settings.facebookUserToSQL,type:"POST",dataType:"json",data:"email="+c.models.userModel.attributes.email+"&age="+c.models.userModel.attributes.age+"&gender="+c.models.userModel.attributes.gender+"&name="+c.models.userModel.attributes.name+"&facebook_data="+JSON.stringify(c.models.userModel.attributes.facebook_data)+"&facebook_id="+c.models.userModel.attributes.facebook_id+"&avatar="+c.models.userModel.attributes.facebook_avatar+"&current_location="+JSON.stringify(c.models.userModel.attributes.current_location),timeout:6e4,success:function(a){a.value===!0?(c.settings.userLoggedIn=!0,c.models.userModel.set("user_id",a.user_id),c.events.facebookUserToSQLEvent.trigger("facebookUserToSQLSuccesHandler")):c.events.createUserErrorEvent.trigger("createUserErrorHandler")}})},getUserFromFacebookID:function(){$.ajax({url:c.settings.servicePath+c.settings.getUserFromFacebookID,type:"GET",dataType:"json",data:"facebook_id="+c.models.userModel.attributes.facebook_id,timeout:6e4,success:function(a){c.models.userModel.attributes.strength_score=a.strength_score,c.models.userModel.attributes.stamina_score=a.stamina_score,c.models.userModel.attributes.equipment_score=a.equipment_score,c.models.userModel.attributes.gender=a.gender,c.models.userModel.attributes.age=a.age,""!==a.avatar&&(c.models.userModel.attributes.avatar=a.avatar,console.log("replaced avatar")),c.events.getUserFromFacebookIDEvent.trigger("facebookGetIDHandler",a)}})},facebookLogin:function(){if(c.settings.native){var a=function(a){if(console.log(a.authResponse+"maarten"),a.authResponse){c.settings.userLoggedIn=!0,c.models.userModel.attributes.facebookUser=!0,c.models.userModel.attributes.name=a.name,c.models.userModel.attributes.email=a.email;var b;b="male"==a.gender?1:0,c.models.userModel.attributes.gender=b,c.models.userModel.attributes.facebook_id=a.id,facebookConnectPlugin.api("/me/picture",function(a){c.models.userModel.attributes.facebook_avatar=a.data.url}),Backbone.trigger("facebookLoginHandler")}else alert("Je kan nu niet inloggen met Facebook, probeer het later opnieuw")};facebookConnectPlugin.login(["basic_info"],a,function(a){alert(""+a)})}else FB.login(function(a){a.authResponse?(c.settings.userLoggedIn=!0,Backbone.trigger("facebookLoginHandler")):alert("Je kan nu niet inloggen met Facebook, probeer het later opnieuw")},{scope:"email"})},facebookWallpost:function(a){console.log(a);var b={method:"feed",name:a.attributes.title,link:c.settings.forwardPath+"#forward/"+a.attributes.activity_id,caption:"We App To Move",description:a.attributes.description};c.settings.native?facebookConnectPlugin.getLoginStatus(function(){facebookConnectPlugin.showDialog(b,function(){Backbone.trigger("FacebookWallPostCompleteEvent")},function(){Backbone.trigger("FacebookWallPostCompleteEvent")})}):FB.ui(b,function(a){a&&a.post_id,Backbone.trigger("FacebookWallPostCompleteEvent")})},getProfileData:function(){c.settings.native?Backbone.trigger("facebookProfileDataHandler"):FB.api("/me",{fields:["id","name","email","username","age_range","gender","hometown","link","favorite_athletes","favorite_teams"]},function(a){c.models.userModel.attributes.facebookUser=!0,c.models.userModel.attributes.name=a.name,c.models.userModel.attributes.email=a.email,a.age_range.min&&(c.models.userModel.attributes.age=a.age_range.min);var b;b="male"==a.gender?1:0,c.models.userModel.attributes.gender=b,c.models.userModel.attributes.facebook_id=a.id,FB.api("/me/picture",function(a){c.models.userModel.attributes.facebook_avatar=a.data.url,Backbone.trigger("facebookProfileDataHandler")})})},getFacebookFriends:function(){c.models.userModel.attributes.friends=[],c.events.facebookGetFriendsEvent.trigger("facebookGetFriendsHandler")}}),c.services.PhpServices=Backbone.Model.extend({initialize:function(){},createActivity:function(a){$.ajax({url:c.settings.servicePath+c.settings.createActivityService,type:"POST",dataType:"json",data:"location_id="+a.attributes.location_id+"&title="+a.attributes.title+"&sport_id="+a.attributes.sport_id+"&description="+a.attributes.description+"&date="+a.attributes.date+"&time="+a.attributes.time+"&stopTime="+a.attributes.stopTime+"&user_id="+c.models.userModel.attributes.user_id+"&participants="+a.attributes.participants,timeout:6e4,success:function(a){a.value===!0&&(Backbone.trigger("activityCreated",a.activity_id),c.services.avatarService.addScore("create"),c.services.challengeService.checkChallenges(c.models.userModel,!1,!0,!1,!1))},error:function(){window.location.hash="dashboard"}})},updateActivity:function(a){$.ajax({url:c.settings.servicePath+c.settings.updateActivityService,type:"POST",dataType:"json",data:"location_id="+a.attributes.location_id+"&activity_id="+a.attributes.activity_id+"&title="+a.attributes.title+"&sport_id="+a.attributes.sport_id+"&description="+a.attributes.description+"&date="+a.attributes.date+"&time="+a.attributes.time+"&stopTime="+a.attributes.stopTime+"&user_id="+c.models.userModel.attributes.user_id+"&participants="+a.attributes.participants,timeout:6e4,success:function(a){a.value===!0&&Backbone.trigger("activityUpdated",a.activity_id)},error:function(){window.location.hash="dashboard"}})},addMessage:function(a,b){$.ajax({url:c.settings.servicePath+c.settings.addMessageService,type:"POST",dataType:"json",data:"message="+a+"&activity_id="+b+"&user_id="+c.models.userModel.attributes.user_id,timeout:6e4,success:function(a){a.value===!0&&(c.events.postMessageSuccesEvent.trigger("postMessageSuccesHandler"),c.services.avatarService.addScore("chat"))}})},createUser:function(){$.ajax({url:c.settings.servicePath+c.settings.addUserService,type:"POST",dataType:"json",data:"email="+c.models.userModel.attributes.email+"&age="+c.models.userModel.attributes.age+"&gender="+c.models.userModel.attributes.gender+"&name="+c.models.userModel.attributes.name+"&password="+c.models.userModel.attributes.password+"&current_location="+JSON.stringify(c.models.userModel.attributes.current_location),timeout:6e4,success:function(a){a.value===!0?(c.settings.userLoggedIn=!0,c.models.userModel.attributes.user_id=a.id,Backbone.trigger("createUserHandler")):c.events.createUserErrorEvent.trigger("createUserErrorHandler")}})},userLogin:function(){$.ajax({url:c.settings.servicePath+c.settings.getUserService,type:"POST",dataType:"json",data:"name="+c.models.userModel.attributes.email+"&password="+c.models.userModel.attributes.password,timeout:6e4,success:function(a){a.status===!0?a.password?(c.models.userModel.set("name",a.name),c.models.userModel.set("avatar",a.avatar),c.models.userModel.set("user_id",a.value),c.models.userModel.attributes.strength_score=a.strength_score,c.models.userModel.attributes.stamina_score=a.stamina_score,c.models.userModel.attributes.equipment_score=a.equipment_score,c.models.userModel.attributes.avatar=a.avatar,c.models.userModel.attributes.age=a.age,c.settings.userLoggedIn=!0,c.events.userLoggedInEvent.trigger("userLoggedInHandler")):c.events.userLoggedInPasswordErrorEvent.trigger("userLoggedInPasswordErrorHandler"):c.events.userLoggedInErrorEvent.trigger("userLoggedInErrorHandler")}})},getMessages:function(a){$.ajax({url:c.settings.servicePath+c.settings.getMessagesService,type:"POST",dataType:"json",data:"activity_id="+a.attributes.activity_id,success:function(a){var b=new MessagesCollection(a);Backbone.trigger("getMessages",b)}})},getMyPlannedActivities:function(){$.ajax({url:c.settings.servicePath+c.settings.getMyPlannedActivities,type:"POST",dataType:"json",data:"user_id="+c.models.userModel.attributes.user_id,success:function(a){c.collections.myPlannedActivities=new ActivitiesCollection(a),Backbone.trigger("myPlannedActivitiesLoadedHandler")}})},getMyActivities:function(){$.ajax({url:c.settings.servicePath+c.settings.getMyActivities,type:"POST",dataType:"json",data:"user_id="+c.models.userModel.attributes.user_id,success:function(a){c.collections.myActivities=new ActivitiesCollection(a),Backbone.trigger("myActivitiesLoadedHandler")}})},getMyCreatedActivities:function(){$.ajax({url:c.settings.servicePath+c.settings.getMyActivitiesService,type:"POST",dataType:"json",data:"user_id="+c.models.userModel.attributes.user_id,success:function(a){c.collections.myActivities=new ActivitiesCollection(a),Backbone.trigger("myActivitiesLoadedHandler")}})},getMedia:function(a){$.ajax({url:c.settings.servicePath+c.settings.getMediaService,type:"POST",dataType:"json",data:"activity_id="+a.attributes.activity_id,success:function(a){var b=new MediaCollection(a);Backbone.trigger("mediaLoadSuccesHandler",b)}})},getActivities:function(a,b){$.ajax({url:c.settings.servicePath+c.settings.getActivitiesService,type:"GET",dataType:"json",success:function(d){c.collections.activities=new ActivitiesCollection(d),a?c.events.getActivitiesSuccesEvent.trigger("activitiesLoadedHandler"):b?c.router.navigate("activity/"+b,!0):Backbone.trigger("dashboardUpdatedHandler")}})},getSports:function(){$.ajax({url:c.settings.servicePath+c.settings.getSportsService,type:"GET",dataType:"json",success:function(a){c.collections.sports=new SportsCollection(a),c.events.getSportsSuccesEvent.trigger("sportsLoadedHandler")}})},getBuurten:function(){$.ajax({url:c.settings.servicePath+c.settings.getBuurtenService,type:"GET",dataType:"json",success:function(a){c.collections.buurten=new BuurtenCollection(a),c.events.getBuurtenEvent.trigger("buurtenLoadedHandler")}})},getChallenges:function(){$.ajax({url:c.settings.servicePath+c.settings.getChallengesService,type:"POST",dataType:"json",data:"user_id="+c.models.userModel.attributes.user_id,success:function(a){c.collections.challenges=new ChallengesCollection(a),Backbone.trigger("getChallengesHandler")}})},getUsers:function(){$.ajax({url:c.settings.servicePath+c.settings.getUsersService,type:"GET",dataType:"json",success:function(a){c.collections.users=new UsersCollection(a),c.events.getUsersSuccesEvent.trigger("usersLoadedHandler")}})},getActivityUsers:function(a){$.ajax({url:c.settings.servicePath+c.settings.getActivityUserService,type:"POST",dataType:"json",data:"activity_id="+a.attributes.activity_id,success:function(a){Backbone.trigger("activityUsersSuccesEvent",a)},error:function(){}})},setGoingToActivity:function(a,b){$.ajax({url:c.settings.servicePath+c.settings.setGoingToActivityService,type:"POST",dataType:"json",data:"user_id="+c.models.userModel.attributes.user_id+"&going="+b+"&activity_id="+a,success:function(){Backbone.trigger("goinToActivitySuccesEvent")},error:function(){}})},getLocations:function(){$.ajax({url:c.settings.servicePath+c.settings.getLocationsService,type:"GET",dataType:"json",success:function(a){c.collections.locations=new LocationsCollection(a),c.events.getLocationsSuccesEvent.trigger("getLocationsSuccesHandler")}})},getFavouriteSports:function(){$.ajax({url:c.settings.servicePath+c.settings.getFavouriteSportsService,type:"GET",dataType:"json",success:function(a){c.collections.favouriteSports=new SportsCollection(a),Backbone.trigger("getFavouriteSportsHandler")}})},addFavouriteSportsService:function(a){$.ajax({url:c.settings.servicePath+c.settings.addFavouriteSportsService,type:"POST",dataType:"json",data:"favourite_sports="+JSON.stringify(a)+"&user_id="+c.models.userModel.attributes.user_id,success:function(){Backbone.trigger("addFavouriteSportsHandler")},error:function(a){console.log(a)}})},getUserFavouriteSports:function(){$.ajax({url:c.settings.servicePath+c.settings.getUserFavouriteSportsService,type:"POST",dataType:"json",data:"user_id="+c.models.userModel.attributes.user_id,success:function(a){c.models.userModel.attributes.myFavouriteSports=new SportsCollection(a),Backbone.trigger("getMyFavouriteSportsHandler")},error:function(){c.models.userModel.attributes.myFavouriteSports=new SportsCollection,Backbone.trigger("getMyFavouriteSportsHandler")}})},addLocation:function(a,b,d){$.ajax({url:c.settings.servicePath+c.settings.addLocationService,type:"POST",dataType:"json",data:"location="+a+"&coordinates="+b+"&description="+d,timeout:6e4,success:function(a){a.value===!0&&Backbone.trigger("addedLocationSuccesEvent",a.location_id)}})},addPhotoToDatabase:function(a,b){$.ajax({url:c.settings.servicePath+c.settings.addPhotoToDatabase,type:"POST",dataType:"json",data:"url="+a+"&user_id="+c.models.userModel.attributes.user_id+"&type=1&activity_id="+b,success:function(){Backbone.trigger("addPhotoToDatabaseHandler"),c.services.avatarService.addScore("media")}})},getMyAvatar:function(){$.ajax({url:c.settings.servicePath+c.settings.getMyAvatarService,type:"POST",dataType:"json",data:"user_id="+c.models.userModel.attributes.user_id,success:function(a){c.models.attributes.avatar_data=a,Backbone.trigger("getAvatarCompleteHandler")}})},getUserAvatar:function(a){$.ajax({url:c.settings.servicePath+c.settings.getMyAvatarService,type:"POST",dataType:"json",data:"user_id="+a,success:function(){Backbone.trigger("getUserAvatarCompleteHandler")}})},getUserChallenges:function(a){$.ajax({url:c.settings.servicePath+c.settings.getUserChallengesService,type:"POST",dataType:"json",data:"user_id="+a,success:function(){Backbone.trigger("getUserChallengesCompleteHandler")}})},updateAvatar:function(){$.ajax({url:c.settings.servicePath+c.settings.updateAvatarService,type:"POST",dataType:"json",data:"user_id="+c.models.userModel.attributes.user_id+"&strength_score="+c.models.userModel.attributes.strength_score+"&stamina_score="+c.models.userModel.attributes.stamina_score+"&equipment_score="+c.models.userModel.attributes.equipment_score,success:function(){Backbone.trigger("updateAvatarCompleteHandler")}})},updateSport:function(){$.ajax({url:c.settings.servicePath+c.settings.updateSportService,type:"POST",dataType:"json",data:"user_id="+c.models.userModel.attributes.user_id+"&strength_score="+c.models.userModel.attributes.strength_score+"&stamina_score="+c.models.userModel.attributes.stamina_score+"&equipment_score="+c.models.userModel.attributes.equipment_score,success:function(){Backbone.trigger("updateAvatarCompleteHandler")}})},getMyChallengesHandler:function(){$.ajax({url:c.settings.servicePath+c.settings.getMyChallengesService,type:"POST",dataType:"json",data:"user_id="+c.models.userModel.attributes.user_id,success:function(a){$(a).each(function(a,b){b.challengeData=b.challengeData.replace(new RegExp("\\\\","g"),""),b.challengeData=b.challengeData.substring(1,b.challengeData.length-1),b.challengeData=JSON.parse(b.challengeData),b.status=b.status.replace(new RegExp("\\\\","g"),""),b.status=b.status.substring(1,b.status.length-1),b.status=JSON.parse(b.status)}),console.log(a),c.models.userModel.attributes.myChallenges=new ChallengesCollection(a),Backbone.trigger("getMyChallengesHandler")}})},getChallengesCount:function(){$.ajax({url:c.settings.servicePath+c.settings.getChallengesCount,type:"POST",dataType:"json",success:function(a){c.models.userModel.attributes.challengesCount=a,Backbone.trigger("getChallengesCount")}})},joinChallenge:function(a){$.ajax({url:c.settings.servicePath+c.settings.joinChallengeService,type:"POST",dataType:"json",data:"user_id="+c.models.userModel.attributes.user_id+"&challenge_id="+a,success:function(){Backbone.trigger("joinedChallengeHandler"),c.services.avatarService.addScore("challenge")},error:function(){alert("errro")}})},getMyBadges:function(){$.ajax({url:c.settings.servicePath+c.settings.getBadgesService,type:"POST",dataType:"json",data:"user_id="+c.models.userModel.attributes.user_id,success:function(a){c.models.userModel.attributes.myBadges=new ChallengesCollection(a),Backbone.trigger("getMyBadgesHandler")}})},getBadges:function(a){$.ajax({url:c.settings.servicePath+c.settings.getBadgesService,type:"POST",dataType:"json",data:"user_id="+a,success:function(a){Backbone.trigger("getBadgesHandler",a)}})},updateChallenge:function(a,b,d){$.ajax({url:c.settings.servicePath+c.settings.updateChallengeService,type:"POST",dataType:"json",data:"user_id="+c.models.userModel.attributes.user_id+"&challenge_id="+a+"&status="+JSON.stringify(b)+"&completed="+d,success:function(){Backbone.trigger("updateChallengeScore")}})},addSport:function(a,b,d){$.ajax({url:c.settings.servicePath+c.settings.addSportService,type:"POST",dataType:"json",data:"sport_title="+a+"&description="+b+"&icon="+d,success:function(a){Backbone.trigger("addedSportHandler",a)}})},getFriends:function(){$.ajax({url:c.settings.servicePath+c.settings.getFriendsService,type:"POST",dataType:"json",data:"user_id="+c.models.userModel.attributes.user_id,success:function(a){c.models.userModel.attributes.myFriends=new UsersCollection(a),Backbone.trigger("getFriendsHandler")},error:function(){alert("errr")}})},addFriend:function(a,b){$.ajax({url:c.settings.servicePath+c.settings.addFriendService,type:"POST",dataType:"json",data:"friend_id="+a+"&friend_from_id="+b,success:function(){Backbone.trigger("addedFriendHandler"),c.services.avatarService.addScore("friend")}})},getMyInvitations:function(){$.ajax({url:c.settings.servicePath+c.settings.getMyInvitationsService,type:"POST",dataType:"json",data:"user_id="+c.models.userModel.attributes.user_id,success:function(a){c.collections.myInvitations=new ActivitiesCollection(a),Backbone.trigger("getInvitationsHandler")}})},getUserMedia:function(a){$.ajax({url:c.settings.servicePath+c.settings.getUserMediaService,type:"POST",dataType:"json",data:"user_id="+a,success:function(a){var b=new MediaCollection(a);Backbone.trigger("userMediaHandler",b)}})},inviteFriends:function(a,b){var d=0;a.each(function(e){$.ajax({url:c.settings.servicePath+c.settings.inviteFriendsService,type:"POST",dataType:"json",data:"user_id="+e.attributes.user_id+"&activty_id="+b,success:function(){d++,d==a.length&&Backbone.trigger("friendsInvitedHandler")}})})},handleInvitations:function(a,b,d){$.ajax({url:c.settings.servicePath+c.settings.handleInvitationsService,type:"POST",dataType:"json",data:"invitation_id="+a+"&accepted="+b+"&activity_id="+d+"&user_id="+c.models.userModel.attributes.user_id,success:function(){console.log("dataaaaaa"),Backbone.trigger("acceptInviteHandler")},error:function(){console.log("error")}})},removeFriend:function(a){$.ajax({url:c.settings.servicePath+c.settings.removeFriendService,type:"POST",dataType:"json",data:"friend_id="+a,success:function(){Backbone.trigger("friendRemovedHandler")},error:function(){console.log("error")}})},updateUserAvatar:function(a){$.ajax({url:c.settings.servicePath+c.settings.updateUserAvatarService,type:"POST",dataType:"json",data:"user_id="+c.models.userModel.attributes.user_id+"&avatar="+a,success:function(){Backbone.trigger("updateUserAvatar")},error:function(){console.log("error")}})},uploadMediaNonNative:function(a){$.ajax({url:c.settings.servicePath+c.settings.uploadMediaNonNativeService+"?files",type:"POST",cache:!1,dataType:"json",data:a,processData:!1,contentType:!1,success:function(a){"undefined"==typeof a.error?(console.log(a),Backbone.trigger("fileUploadedEvent",a)):console.log("ERRORS: "+a.error)},error:function(a,b){console.log("ERRORS: "+b)}})}}),c.services.UtilServices=Backbone.Model.extend({initialize:function(){},getNetworkConnection:function(){if(c.settings.native){var a=navigator.connection.type,b={};b[Connection.UNKNOWN]=!1,b[Connection.ETHERNET]=!0,b[Connection.WIFI]=!0,b[Connection.CELL_2G]=!0,b[Connection.CELL_3G]=!0,b[Connection.CELL_4G]=!0,b[Connection.CELL]=!0,b[Connection.NONE]=!1,c.settings.network=b[a]}else c.settings.network=!0;return c.settings.network},getLatLon:function(a){$.ajax({url:"http://maps.google.com/maps/api/geocode/json?address="+a+"&sensor=false&region=be",type:"GET",dataType:"json",success:function(a){console.log(a);var b=a.results[0];c.events.getLatLonEvent.trigger("getLatLonSuccesHandler",b)},error:function(){}})},reverseGeo:function(a,b){var c=new google.maps.LatLng(a,b);geocoder.geocode({latLng:c},function(a,b){b==google.maps.GeocoderStatus.OK?a[1]&&alert(a[1].formatted_address):alert("Geocoder failed due to: "+b)})},getLocationService:function(a){function b(b){switch(a){case"login":c.events.locationHomeEvent.trigger("locationSuccesHandler",b);break;case"createActivity":c.events.locationCreateActivityEvent.trigger("locationSuccesHandler",b);break;case"dashboard":Backbone.trigger("getMyLocationHandler",b);break;case"create":Backbone.trigger("createUserLocationHandler",b)}}function d(){switch(a){case"login":Backbone.trigger("locationError");break;case"createActivity":c.events.locationCreateActivityEvent.trigger("locationSuccesHandler",e)}}if(navigator.geolocation){navigator.geolocation.getCurrentPosition(b,d);var e=[]}else c.events.locationEvent.trigger("locationErrorHandler",e)},localDataToCollection:function(a){c.collections.activities=new ActivitiesCollection(a.activities),c.collections.buurten=new BuurtenCollection(a.buurten),c.collections.challenges=new ChallengesCollection(a.challenges),c.collections.favouriteSports=new SportsCollection(a.favouriteSports),c.collections.locations=new LocationsCollection(a.locations),c.collections.myActivities=new ActivitiesCollection(a.myActivities),c.collections.myPlannedActivities=new ActivitiesCollection(a.myPlannedActivities),c.collections.myInvitations=new ActivitiesCollection(a.myInvitations),c.collections.myJoinedActivitiesView=new ActivitiesCollection(a.myJoinedActivitiesView),c.collections.sortOptions=new SortOptionsCollection(a.sortOptions),c.collections.sports=new SportsCollection(a.sports),c.collections.users=new UsersCollection(a.users),c.settings.dataLoaded=!0
},updateLocalStorage:function(){var a=function(){try{return localStorage.setItem(mod,mod),localStorage.removeItem(mod),!0}catch(a){return!1}}();a&&(window.localStorage.setItem("collections",JSON.stringify(c.collections)),window.localStorage.setItem("userModel",JSON.stringify(c.models.userModel)))},checkConnection:function(){var a=navigator.connection.type,b={};b[Connection.UNKNOWN]=!1,b[Connection.ETHERNET]=!0,b[Connection.WIFI]=!0,b[Connection.CELL_2G]=!0,b[Connection.CELL_3G]=!0,b[Connection.CELL_4G]=!0,b[Connection.CELL]=!1,b[Connection.NONE]=!1,c.settings.network=b[a]},convertDate:function(a,b,c){var d=a+" "+b,e=d.split(/\D/),f=e[1]-1,a=new Date(e[0],f,e[2],e[3],e[4]);return c&&(a=new Date(a.getTime()-18e5)),a}}),c.utils.templates=function(){var a=function(a,b){var d=[];$.each(a,function(a,b){c.views[b]?d.push($.get("public/templates/"+b+".html",function(a){c.views[b].prototype.template=_.template(a)},"html")):alert(b+" not found")}),$.when.apply(null,d).done(b)};return{load:a}}()}({},function(){return this}());